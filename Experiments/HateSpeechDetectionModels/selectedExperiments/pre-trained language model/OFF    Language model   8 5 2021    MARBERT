{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"name":"OFF |  Language model | 8/5/2021  | MARBERT ","provenance":[{"file_id":"1KCriX3qoEakAJNvPGXvotxGSwy09_453","timestamp":1620380931707},{"file_id":"1P9iQHtUH5KUbTVtp8B4-AopZzEEPE0lw","timestamp":1618868148454}],"collapsed_sections":[],"toc_visible":true},"kernelspec":{"name":"python3","display_name":"Python 3"},"accelerator":"GPU","widgets":{"application/vnd.jupyter.widget-state+json":{"a3c6d32b0095424eb052d5150ba2ee19":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_98a889bb9da24e0ab310fccb1d3bc327","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_c744607ba0734567bd8d4a061a990a76","IPY_MODEL_822ad9868009429d9980682b87c0cf91"]}},"98a889bb9da24e0ab310fccb1d3bc327":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"c744607ba0734567bd8d4a061a990a76":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_2f25bf6092b14fed848ad34afd6f5b7b","_dom_classes":[],"description":"Downloading: 100%","_model_name":"FloatProgressModel","bar_style":"success","max":701,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":701,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_65067a4512984dbb893114317bda1b52"}},"822ad9868009429d9980682b87c0cf91":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_ed22f8483dea4d3c8a2db16b6c5df6bc","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 701/701 [00:00&lt;00:00, 5.26kB/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_aa2b5f1f92394a46b153165f352f217f"}},"2f25bf6092b14fed848ad34afd6f5b7b":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"65067a4512984dbb893114317bda1b52":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"ed22f8483dea4d3c8a2db16b6c5df6bc":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"aa2b5f1f92394a46b153165f352f217f":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"c96af1b6e3754af4b583f803553492b6":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_074ea901c8d7483ca775d7a71e0226c0","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_aceaa622ed7346a6adcb8e3b8f99878c","IPY_MODEL_b1eb78615634456e8b23c3f6a3ea8a1d"]}},"074ea901c8d7483ca775d7a71e0226c0":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"aceaa622ed7346a6adcb8e3b8f99878c":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_31ca0df388984eafad6f76d77df70bb2","_dom_classes":[],"description":"Downloading: 100%","_model_name":"FloatProgressModel","bar_style":"success","max":1099714,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":1099714,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_abae0d0e466d48148a91895e73986f35"}},"b1eb78615634456e8b23c3f6a3ea8a1d":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_067257754e2b4523bd14a6f4407780a7","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 1.10M/1.10M [00:00&lt;00:00, 2.46MB/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_21c3cad80f954f27975d19c62a57571e"}},"31ca0df388984eafad6f76d77df70bb2":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"abae0d0e466d48148a91895e73986f35":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"067257754e2b4523bd14a6f4407780a7":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"21c3cad80f954f27975d19c62a57571e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"f68c5f68dda645c68fe74594befc5fb8":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_9943e7c929614e6fa69e2257d03c7632","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_be05172dafba4c0d8c315aacb9da9dfb","IPY_MODEL_e0ea5a2d05ce44af987688ee4e0cc980"]}},"9943e7c929614e6fa69e2257d03c7632":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"be05172dafba4c0d8c315aacb9da9dfb":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_5dc6acc1c4a949ab862cc323ebf081dd","_dom_classes":[],"description":"Downloading: 100%","_model_name":"FloatProgressModel","bar_style":"success","max":112,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":112,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_da6d2f9d069340dfa51f4d408fde5932"}},"e0ea5a2d05ce44af987688ee4e0cc980":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_40b79d0c20244d0aac752c76713d8764","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 112/112 [00:00&lt;00:00, 401B/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_b7246fd89c0241a38e043dd9df5f0725"}},"5dc6acc1c4a949ab862cc323ebf081dd":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"da6d2f9d069340dfa51f4d408fde5932":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"40b79d0c20244d0aac752c76713d8764":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"b7246fd89c0241a38e043dd9df5f0725":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"c6fcc928af284ddd9ea110889c498b03":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_6f962622361446cf9df5df64c81a391f","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_ae9ec21f516145ef80ddb829e42c41b7","IPY_MODEL_a5e7dfdfa92540fbaca2a8bff7e8c227"]}},"6f962622361446cf9df5df64c81a391f":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"ae9ec21f516145ef80ddb829e42c41b7":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_33ca5e8a159f450d94ff90083b6f399c","_dom_classes":[],"description":"Downloading: 100%","_model_name":"FloatProgressModel","bar_style":"success","max":376,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":376,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_554f713218684cb4aa57d2bfd1f9a6cb"}},"a5e7dfdfa92540fbaca2a8bff7e8c227":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_c9c4db63624c4e6b9496bb8bdd59e0e6","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 376/376 [00:00&lt;00:00, 2.09kB/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_14f9cc845e504de488ff03c177e45887"}},"33ca5e8a159f450d94ff90083b6f399c":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"554f713218684cb4aa57d2bfd1f9a6cb":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"c9c4db63624c4e6b9496bb8bdd59e0e6":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"14f9cc845e504de488ff03c177e45887":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"149ad7b2ec754e0c8f3924f678f3cc94":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_aae3af7c1a944b05bf1209c2ad1c5764","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_a508edc945aa43d59b3b64369a6bb71e","IPY_MODEL_0930eb7c66564861827846dfe0a81d48"]}},"aae3af7c1a944b05bf1209c2ad1c5764":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"a508edc945aa43d59b3b64369a6bb71e":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_d95c4b821670425e8e33a6d5d4ac5982","_dom_classes":[],"description":"Downloading: 100%","_model_name":"FloatProgressModel","bar_style":"success","max":654186400,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":654186400,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_8e7ea19cd8c54887a1ee6e22ecc5eb6e"}},"0930eb7c66564861827846dfe0a81d48":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_58b42dc870eb4e608817756c8a367c96","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 654M/654M [00:13&lt;00:00, 47.0MB/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_eee955b6c21340438e3b105ae9d16fbd"}},"d95c4b821670425e8e33a6d5d4ac5982":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"8e7ea19cd8c54887a1ee6e22ecc5eb6e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"58b42dc870eb4e608817756c8a367c96":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"eee955b6c21340438e3b105ae9d16fbd":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}}}}},"cells":[{"cell_type":"markdown","metadata":{"id":"g4mZ8KYblg-g"},"source":["#installing dependencies"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"IbHOBNd4ETRD","executionInfo":{"status":"ok","timestamp":1620381058625,"user_tz":-180,"elapsed":23776,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"1260a35b-e3ab-40af-9bcf-3c99783dc9ee"},"source":["from google.colab import drive\n","drive.mount('/content/drive')\n"],"execution_count":null,"outputs":[{"output_type":"stream","text":["Mounted at /content/drive\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"C4tlwQ8si_FI","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1620381067569,"user_tz":-180,"elapsed":4487,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"8febbd3e-25c9-474f-d186-a711716a9725"},"source":["import torch\n","\n","# If there's a GPU available...\n","if torch.cuda.is_available():    \n","\n","    # Tell PyTorch to use the GPU.    \n","    device = torch.device(\"cuda\")\n","\n","    print('There are %d GPU(s) available.' % torch.cuda.device_count())\n","\n","    print('We will use the GPU:', torch.cuda.get_device_name(0))\n","    !nvidia-smi\n","\n","# If not...\n","else:\n","    print('No GPU available, using the CPU instead.')\n","    device = torch.device(\"cpu\")"],"execution_count":null,"outputs":[{"output_type":"stream","text":["There are 1 GPU(s) available.\n","We will use the GPU: Tesla T4\n","Fri May  7 09:51:07 2021       \n","+-----------------------------------------------------------------------------+\n","| NVIDIA-SMI 465.19.01    Driver Version: 460.32.03    CUDA Version: 11.2     |\n","|-------------------------------+----------------------+----------------------+\n","| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n","| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n","|                               |                      |               MIG M. |\n","|===============================+======================+======================|\n","|   0  Tesla T4            Off  | 00000000:00:04.0 Off |                    0 |\n","| N/A   51C    P8    11W /  70W |      3MiB / 15109MiB |      0%      Default |\n","|                               |                      |                  N/A |\n","+-------------------------------+----------------------+----------------------+\n","                                                                               \n","+-----------------------------------------------------------------------------+\n","| Processes:                                                                  |\n","|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |\n","|        ID   ID                                                   Usage      |\n","|=============================================================================|\n","|  No running processes found                                                 |\n","+-----------------------------------------------------------------------------+\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"y024z5AnlTLz","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1620381092238,"user_tz":-180,"elapsed":29145,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"71ce734b-8045-4e00-fc9f-731ce70a806d"},"source":["!pip install -q optuna==2.3.0\n","!pip install -q transformers==4.2.1\n","!pip install -q farasapy\n","!pip install -q pyarabic\n","!git clone https://huggingface.co/UBC-NLP/MARBERT"],"execution_count":null,"outputs":[{"output_type":"stream","text":["\u001b[?25l\r\u001b[K     |█▎                              | 10kB 27.5MB/s eta 0:00:01\r\u001b[K     |██▌                             | 20kB 34.2MB/s eta 0:00:01\r\u001b[K     |███▉                            | 30kB 21.5MB/s eta 0:00:01\r\u001b[K     |█████                           | 40kB 23.8MB/s eta 0:00:01\r\u001b[K     |██████▍                         | 51kB 24.7MB/s eta 0:00:01\r\u001b[K     |███████▋                        | 61kB 26.7MB/s eta 0:00:01\r\u001b[K     |████████▉                       | 71kB 19.5MB/s eta 0:00:01\r\u001b[K     |██████████▏                     | 81kB 20.2MB/s eta 0:00:01\r\u001b[K     |███████████▍                    | 92kB 19.1MB/s eta 0:00:01\r\u001b[K     |████████████▊                   | 102kB 19.1MB/s eta 0:00:01\r\u001b[K     |██████████████                  | 112kB 19.1MB/s eta 0:00:01\r\u001b[K     |███████████████▏                | 122kB 19.1MB/s eta 0:00:01\r\u001b[K     |████████████████▌               | 133kB 19.1MB/s eta 0:00:01\r\u001b[K     |█████████████████▊              | 143kB 19.1MB/s eta 0:00:01\r\u001b[K     |███████████████████             | 153kB 19.1MB/s eta 0:00:01\r\u001b[K     |████████████████████▎           | 163kB 19.1MB/s eta 0:00:01\r\u001b[K     |█████████████████████▌          | 174kB 19.1MB/s eta 0:00:01\r\u001b[K     |██████████████████████▉         | 184kB 19.1MB/s eta 0:00:01\r\u001b[K     |████████████████████████        | 194kB 19.1MB/s eta 0:00:01\r\u001b[K     |█████████████████████████▍      | 204kB 19.1MB/s eta 0:00:01\r\u001b[K     |██████████████████████████▋     | 215kB 19.1MB/s eta 0:00:01\r\u001b[K     |███████████████████████████▉    | 225kB 19.1MB/s eta 0:00:01\r\u001b[K     |█████████████████████████████▏  | 235kB 19.1MB/s eta 0:00:01\r\u001b[K     |██████████████████████████████▍ | 245kB 19.1MB/s eta 0:00:01\r\u001b[K     |███████████████████████████████▊| 256kB 19.1MB/s eta 0:00:01\r\u001b[K     |████████████████████████████████| 266kB 19.1MB/s \n","\u001b[?25h  Installing build dependencies ... \u001b[?25l\u001b[?25hdone\n","  Getting requirements to build wheel ... \u001b[?25l\u001b[?25hdone\n","    Preparing wheel metadata ... \u001b[?25l\u001b[?25hdone\n","\u001b[K     |████████████████████████████████| 81kB 11.8MB/s \n","\u001b[K     |████████████████████████████████| 1.2MB 56.1MB/s \n","\u001b[K     |████████████████████████████████| 143kB 48.7MB/s \n","\u001b[K     |████████████████████████████████| 112kB 58.1MB/s \n","\u001b[K     |████████████████████████████████| 51kB 7.6MB/s \n","\u001b[K     |████████████████████████████████| 81kB 10.4MB/s \n","\u001b[?25h  Building wheel for optuna (PEP 517) ... \u001b[?25l\u001b[?25hdone\n","  Building wheel for alembic (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Building wheel for pyperclip (setup.py) ... \u001b[?25l\u001b[?25hdone\n","\u001b[K     |████████████████████████████████| 1.8MB 17.2MB/s \n","\u001b[K     |████████████████████████████████| 901kB 54.4MB/s \n","\u001b[K     |████████████████████████████████| 2.9MB 53.9MB/s \n","\u001b[K     |████████████████████████████████| 112kB 21.3MB/s \n","\u001b[?25h  Building wheel for pyarabic (setup.py) ... \u001b[?25l\u001b[?25hdone\n","Cloning into 'MARBERT'...\n","remote: Enumerating objects: 38, done.\u001b[K\n","remote: Counting objects: 100% (38/38), done.\u001b[K\n","remote: Compressing objects: 100% (36/36), done.\u001b[K\n","remote: Total 38 (delta 15), reused 0 (delta 0)\u001b[K\n","Unpacking objects: 100% (38/38), done.\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"krBvefg6l6vv"},"source":["!mkdir data\n","!mkdir train"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"TVay9KamnC3I"},"source":["#Creating training datasets"]},{"cell_type":"code","metadata":{"id":"hr84ozGinCFh"},"source":["import pandas as pd\n","import numpy as np\n","import re\n","\n","from tqdm import tqdm_notebook as tqdm\n","from sklearn.model_selection import train_test_split\n","all_datasets= []"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"8PhWP2JzrEci"},"source":["class Dataset:\n","    def __init__(\n","        self,\n","        name,\n","        train,\n","        valid,\n","        test,\n","        label_list,\n","        # label_list_valid,\n","        # label_list_test\n","    ):\n","        self.name = name\n","        self.train = train\n","        self.valid = valid\n","        self.test = test\n","        self.label_list = label_list\n","        # self.label_list_valid = label_list_valid\n","        # self.label_list_test = label_list_test"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"joWPYWGMqLau"},"source":["##Semeval Dataset "]},{"cell_type":"code","metadata":{"id":"lt_lGy85zuca"},"source":["text_cleaning_re = \"[a-zA-Z]|\\d+|[٠١٢٣٤٥٦٧٨٩]|[.#،<>:@,\\\\-_”“٪ًَ]\"\n","def preprocess(text):\n","  # search = [\"أ\",\"إ\",\"آ\",\"ة\",\"_\",\"-\",\"/\",\".\",\"،\",\" و \",\" يا \",'\"',\"ـ\",\"'\",\"ى\",\"\\\\\",'\\n', '\\t','&quot;','?','؟','!','#']\n","  # replace = [\"ا\",\"ا\",\"ا\",\"ه\",\" \",\" \",\"\",\"\",\"\",\" و\",\" يا\",\"\",\"\",\"\",\"ي\",\"\",' ', ' ',' ',' ? ',' ؟ ',' ! ',' ']\n","  #remove tashkeel\n","  p_tashkeel = re.compile(r'[\\u0617-\\u061A\\u064B-\\u0652]')\n","  text = re.sub(p_tashkeel,\"\", str(text))\n","  # text = text.replace('وو', 'و')\n","  # text = text.replace('يي', 'ي')\n","  # text = text.replace('اا', 'ا')\n","  text = re.sub(text_cleaning_re, ' ', str(text).lower()).strip()\n","  #remove longation\n","  text = re.sub(r'(.)\\1+', r'\\1\\1', str(text)) \n","  text = re.sub(\"[إأآا]\", \"ا\", str(text))\n","  text = re.sub(\"ى\", \"ي\", str(text))\n","  # text = re.sub(\"ؤ\", \"ء\", text)\n","  # text = re.sub(\"ئ\", \"ء\", text)\n","  text = re.sub(\"ة\", \"ه\", str(text))\n","  # for i in range(0, len(search)):\n","  #       text = text.replace(search[i], replace[i])\n","  \n","   #trim    \n","  # text = text.strip()\n","\n","  tokens = []\n","  for token in text.split():\n","    # if token not in stop_words:\n","      tokens.append(token)\n","  return \" \".join(tokens)"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"mkr9X8_q47Jc"},"source":[""],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"-6oL3qkXmOgJ","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1620381096310,"user_tz":-180,"elapsed":33197,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"370d8fb9-c045-4a16-d2b0-738e63fa21fd"},"source":["#load dataset\n","df_train = pd.read_excel(\"/content/drive/MyDrive/MasterThesis/DataSet-forUsing/semeval2020/train.xlsx\")\n","df_valid = pd.read_excel('/content/drive/MyDrive/MasterThesis/DataSet-forUsing/semeval2020/dev.xlsx')\n","df_test_tweets = pd.read_excel('/content/drive/MyDrive/MasterThesis/DataSet-forUsing/semeval2020/test.xlsx')\n","df_test_labels = pd.read_excel('/content/drive/MyDrive/MasterThesis/DataSet-forUsing/semeval2020/offLabel.xlsx')\n","\n","#Rename Columns\n","df_train = df_train.rename(columns={'off': 'OFF_Labels','hs': 'HS_Labels'})\n","df_valid = df_valid.rename(columns={'off': 'OFF_Labels','hs': 'HS_Labels'})\n","df_test_labels=df_test_labels.rename(columns={'labels':'OFF_Labels'})\n","\n","df_test=pd.concat([df_test_tweets, df_test_labels], axis=1)\n","\n","#drop any row have null values\n","df_train=df_train.dropna(how='any',axis=0)\n","df_valid=df_valid.dropna(how='any',axis=0)\n","df_train.drop(columns=['HS_Labels'])\n","df_valid.drop(columns=['HS_Labels'])\n","\n","# ----------------------------------------------------------------- #\n","DATA_COLUMN = \"tweets\"\n","LABEL_COLUMN = \"OFF_Labels\"\n","\n","# ----------------------------------------------------------------- #\n","\n","df_train = df_train[['tweets','OFF_Labels']]\n","df_valid = df_valid[['tweets','OFF_Labels']]\n","df_test = df_test[['tweets','OFF_Labels']]\n","df_train.columns = [DATA_COLUMN, LABEL_COLUMN]\n","df_valid.columns = [DATA_COLUMN, LABEL_COLUMN]\n","df_test.columns = [DATA_COLUMN,LABEL_COLUMN]\n","# df_test_labels.columns = [LABEL_COLUMN]\n","print(df_train[LABEL_COLUMN].value_counts())\n","print(df_valid[LABEL_COLUMN].value_counts())\n","print(df_test[LABEL_COLUMN].value_counts())\n","\n","label_list_semeval = ['OFF','NOT_OFF']\n","data_semeval = Dataset(\"Data-semeval\", df_train, df_valid,df_test,label_list_semeval)\n","all_datasets.append(data_semeval)\n","\n","# ----------------------------------------------------------------- #\n"],"execution_count":null,"outputs":[{"output_type":"stream","text":["NOT_OFF    5576\n","OFF        1408\n","Name: OFF_Labels, dtype: int64\n","NOT_OFF    821\n","OFF        179\n","Name: OFF_Labels, dtype: int64\n","NOT_OFF    1598\n","OFF         402\n","Name: OFF_Labels, dtype: int64\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"-WYy5ikAs7l3","colab":{"base_uri":"https://localhost:8080/","height":419},"executionInfo":{"status":"ok","timestamp":1620381096316,"user_tz":-180,"elapsed":33197,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"85e96282-1c3a-4343-82b0-f131113ae0f4"},"source":["# %load_ext google.colab.data_table\n","df_train"],"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>tweets</th>\n","      <th>OFF_Labels</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>الحمدلله يارب فوز مهم يا زمالك.. كل الدعم ليكم...</td>\n","      <td>NOT_OFF</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>فدوه يا بخت فدوه يا زمن واحد منكم يجيبه</td>\n","      <td>NOT_OFF</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>RT @USER: يا رب يا واحد يا أحد بحق يوم الاحد ا...</td>\n","      <td>OFF</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>RT @USER: #هوا_الحرية يا وجع قلبي عليكي يا امي...</td>\n","      <td>NOT_OFF</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>يا بكون بحياتك الأهم يا إما ما بدي أكون 🎼</td>\n","      <td>NOT_OFF</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>6995</th>\n","      <td>@USER يا حمار ، يا جاهل ، نسبة الباطل ما بتتحس...</td>\n","      <td>OFF</td>\n","    </tr>\n","    <tr>\n","      <th>6996</th>\n","      <td>RT @USER: @USER كل زق يا طاقية يا واطي يا حقير...</td>\n","      <td>OFF</td>\n","    </tr>\n","    <tr>\n","      <th>6997</th>\n","      <td>@USER&lt;LF&gt;يا كبير يا ممتع يا نجم لابد أن تعي جي...</td>\n","      <td>NOT_OFF</td>\n","    </tr>\n","    <tr>\n","      <th>6998</th>\n","      <td>يا رب الاتحاد يفوز يا رب. 😭😭 #الاتحاد_النصر</td>\n","      <td>NOT_OFF</td>\n","    </tr>\n","    <tr>\n","      <th>6999</th>\n","      <td>يعز عليا ادخل الشارع وملاقيكش واقف مستنيني في ...</td>\n","      <td>NOT_OFF</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>6984 rows × 2 columns</p>\n","</div>"],"text/plain":["                                                 tweets OFF_Labels\n","0     الحمدلله يارب فوز مهم يا زمالك.. كل الدعم ليكم...    NOT_OFF\n","1               فدوه يا بخت فدوه يا زمن واحد منكم يجيبه    NOT_OFF\n","2     RT @USER: يا رب يا واحد يا أحد بحق يوم الاحد ا...        OFF\n","3     RT @USER: #هوا_الحرية يا وجع قلبي عليكي يا امي...    NOT_OFF\n","4             يا بكون بحياتك الأهم يا إما ما بدي أكون 🎼    NOT_OFF\n","...                                                 ...        ...\n","6995  @USER يا حمار ، يا جاهل ، نسبة الباطل ما بتتحس...        OFF\n","6996  RT @USER: @USER كل زق يا طاقية يا واطي يا حقير...        OFF\n","6997  @USER<LF>يا كبير يا ممتع يا نجم لابد أن تعي جي...    NOT_OFF\n","6998        يا رب الاتحاد يفوز يا رب. 😭😭 #الاتحاد_النصر    NOT_OFF\n","6999  يعز عليا ادخل الشارع وملاقيكش واقف مستنيني في ...    NOT_OFF\n","\n","[6984 rows x 2 columns]"]},"metadata":{"tags":[]},"execution_count":12}]},{"cell_type":"code","metadata":{"id":"osrsO7ug2OY8"},"source":[""],"execution_count":null,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"Bcwdslw7v0Q8"},"source":["#Trainer"]},{"cell_type":"code","metadata":{"id":"HUn2RB6Bvrxj"},"source":["from transformers import AutoTokenizer, AutoModelForMaskedLM,BertForSequenceClassification,AutoModel\n","import numpy as np\n","from sklearn.metrics import classification_report, accuracy_score, f1_score, confusion_matrix, precision_score , recall_score\n","\n","from transformers import AutoConfig, AutoModelForSequenceClassification, AutoTokenizer, BertTokenizer\n","from transformers.data.processors import SingleSentenceClassificationProcessor\n","from transformers import Trainer , TrainingArguments\n","from transformers.trainer_utils import EvaluationStrategy\n","from transformers.data.processors.utils import InputFeatures\n","from torch.utils.data import Dataset\n","from torch.utils.data import DataLoader\n","from sklearn.utils import resample\n","import logging\n","import torch\n","import optuna \n","# from arabert.preprocess_arabert import preprocess, never_split_tokens\n"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"KfNKr05tv7cA"},"source":["logging.basicConfig(level=logging.WARNING)\n","logger = logging.getLogger(__name__)"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"R4SGYoB2EDJD","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1620381099878,"user_tz":-180,"elapsed":36745,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"a2ad8a0e-11a1-4dbc-a37d-28a08736c0cf"},"source":["for x in all_datasets:\n","  print(x.name)"],"execution_count":null,"outputs":[{"output_type":"stream","text":["Data-semeval\n"],"name":"stdout"}]},{"cell_type":"markdown","metadata":{"id":"62Lma6tT5zJi"},"source":["You can choose which model, and dataset from here along with the max sentence length"]},{"cell_type":"code","metadata":{"id":"vzeVFoz1wDYf"},"source":["dataset_name = 'Data-semeval'\n","# model_name = 'qarib/bert-base-qarib'\n","# https://huggingface.co/UBC-NLP/MARBERT\n","model_name = 'UBC-NLP/MARBERT'\n","task_name = 'classification'\n","# num_labels = 2\n","max_len = 256\n"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"tcbD2PCiX4vw","executionInfo":{"status":"ok","timestamp":1620381099879,"user_tz":-180,"elapsed":36738,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"e7815109-963c-43a9-d5bf-22ad7f99416b"},"source":["for d in all_datasets:\n","  if d.name==dataset_name:\n","    selected_dataset = d\n","    print('Dataset found \\n',dataset_name)\n","    break"],"execution_count":null,"outputs":[{"output_type":"stream","text":["Dataset found \n"," Data-semeval\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"PoyaRIGYCEzh"},"source":["# arabert_prep = ArabertPreprocessor(model_name.split(\"/\")[-1])\n","\n","selected_dataset.train[DATA_COLUMN] = selected_dataset.train[DATA_COLUMN].apply(lambda x:   preprocess(x))\n","selected_dataset.valid[DATA_COLUMN] = selected_dataset.valid[DATA_COLUMN].apply(lambda x:   preprocess(x))\n","selected_dataset.test[DATA_COLUMN] = selected_dataset.test[DATA_COLUMN].apply(lambda x:  preprocess(x))  "],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"WE_MmGDceJxj","executionInfo":{"status":"ok","timestamp":1620381100489,"user_tz":-180,"elapsed":37341,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"fed3fac9-7680-4102-f079-fe6c25d29024"},"source":["selected_dataset.test[DATA_COLUMN]"],"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["0       اما انت تقعد طول عمرك لا مبدا ولا راي ثابت يا ...\n","1       بتخاف نسوانك يزعلوا ولا ايه 😂 اه يا هلفوت يا ب...\n","2       يا عـسانـي نـبـقي يا عـمري حـبايـب وحـبنـا يكب...\n","3       باقي البيان وينو ما شفنه يا برهان ورينا يا بره...\n","4       اللهم انت الشافي المعافي اشفيه وجميع مرضي المس...\n","                              ...                        \n","1995    الله لايوفقك يا مهند عسيري يا معوق ولا كان مرت...\n","1996                   حبيبي يا يوسف وانت طيب يا صاحبي 💘💘\n","1997    يا بو محمد عشت يا طيب الفال عاشت يمينك يا جزيل...\n","1998    انا مستني الحلقه بقالي سنتين يا بضان يا ابن ال...\n","1999    انتظروا العقوبه الالهيه يا من تدعمون الارهاب ي...\n","Name: tweets, Length: 2000, dtype: object"]},"metadata":{"tags":[]},"execution_count":20}]},{"cell_type":"code","metadata":{"id":"4YS7XI2bZTyz"},"source":["class BERTDataset(Dataset):\n","    def __init__(self, text, target, model_name, max_len, label_map):\n","      super(BERTDataset).__init__()\n","      self.text = text\n","      self.target = target\n","      self.tokenizer_name = model_name\n","      self.tokenizer = AutoTokenizer.from_pretrained(model_name)\n","      self.max_len = max_len\n","      self.label_map = label_map\n","      \n","\n","    def __len__(self):\n","      return len(self.text)\n","\n","    def __getitem__(self,item):\n","      text = str(self.text[item])\n","      text = \" \".join(text.split())\n","\n","\n","        \n","      input_ids = self.tokenizer.encode(\n","          text,\n","          add_special_tokens=True,\n","          max_length=self.max_len,\n","          truncation='longest_first'\n","      )     \n","    \n","      attention_mask = [1] * len(input_ids)\n","\n","      # Zero-pad up to the sequence length.\n","      padding_length = self.max_len - len(input_ids)\n","      input_ids = input_ids + ([self.tokenizer.pad_token_id] * padding_length)\n","      attention_mask = attention_mask + ([0] * padding_length)    \n","      \n","      return InputFeatures(input_ids=input_ids, attention_mask=attention_mask, label=self.label_map[self.target[item]])"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"jeS-X4DP25Sq"},"source":["# config = AutoConfig.from_pretrained(model_name,num_labels=num_labels, output_attentions=True) ##needed for the visualizations\n","# tokenizer = AutoTokenizer.from_pretrained(model_name, do_lower_case=False, do_basic_tokenize=True)\n","# model = AutoModel.from_pretrained(model_name,config=config)\n","# # # AutoModelForMaskedLM"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"GCwNQrY_3sq3"},"source":["# print(config)\n","# print(model)"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"_ieCOj90aw8X"},"source":["# train_dataset = SingleSentenceClassificationProcessor(mode='classification')\n","# valid_dataset = SingleSentenceClassificationProcessor(mode='classification')\n","# test_dataset = SingleSentenceClassificationProcessor(mode='classification')"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"UMMf54S44MS9"},"source":["# train_dataset.add_examples(texts_or_text_and_labels=df_train['tweets'],labels=df_train['HS_Labels'],overwrite_examples = True)\n","# valid_dataset.add_examples(texts_or_text_and_labels=df_valid['tweets'],labels=df_valid['HS_Labels'],overwrite_examples = True)\n","# test_dataset.add_examples(texts_or_text_and_labels=df_test['tweets'],labels=df_test_labels['HS_Labels'],overwrite_examples = True)\n","\n","# print(train_dataset.examples[0])\n","# # print(valid_dataset.examples[0])"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"fRRt4d1LPUny"},"source":["# train_features = train_dataset.get_features(tokenizer = tokenizer, max_len = max_len)\n","# valid_features = valid_dataset.get_features(tokenizer = tokenizer, max_length = max_length)\n","# test_features = test_dataset.get_features(tokenizer = tokenizer, max_length = max_length)"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"mciZOFz-amkV","colab":{"base_uri":"https://localhost:8080/","height":230,"referenced_widgets":["a3c6d32b0095424eb052d5150ba2ee19","98a889bb9da24e0ab310fccb1d3bc327","c744607ba0734567bd8d4a061a990a76","822ad9868009429d9980682b87c0cf91","2f25bf6092b14fed848ad34afd6f5b7b","65067a4512984dbb893114317bda1b52","ed22f8483dea4d3c8a2db16b6c5df6bc","aa2b5f1f92394a46b153165f352f217f","c96af1b6e3754af4b583f803553492b6","074ea901c8d7483ca775d7a71e0226c0","aceaa622ed7346a6adcb8e3b8f99878c","b1eb78615634456e8b23c3f6a3ea8a1d","31ca0df388984eafad6f76d77df70bb2","abae0d0e466d48148a91895e73986f35","067257754e2b4523bd14a6f4407780a7","21c3cad80f954f27975d19c62a57571e","f68c5f68dda645c68fe74594befc5fb8","9943e7c929614e6fa69e2257d03c7632","be05172dafba4c0d8c315aacb9da9dfb","e0ea5a2d05ce44af987688ee4e0cc980","5dc6acc1c4a949ab862cc323ebf081dd","da6d2f9d069340dfa51f4d408fde5932","40b79d0c20244d0aac752c76713d8764","b7246fd89c0241a38e043dd9df5f0725","c6fcc928af284ddd9ea110889c498b03","6f962622361446cf9df5df64c81a391f","ae9ec21f516145ef80ddb829e42c41b7","a5e7dfdfa92540fbaca2a8bff7e8c227","33ca5e8a159f450d94ff90083b6f399c","554f713218684cb4aa57d2bfd1f9a6cb","c9c4db63624c4e6b9496bb8bdd59e0e6","14f9cc845e504de488ff03c177e45887"]},"executionInfo":{"status":"ok","timestamp":1620381102106,"user_tz":-180,"elapsed":38940,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"1463365c-203f-4c66-c63f-caf6aa5c2c46"},"source":["label_map = { v:index for index, v in enumerate(selected_dataset.label_list) }\n","print(label_map)\n","# label_map_test = { v:index for index, v in enumerate(df_test_labels.HS_Labels) }\n","# print(label_map_test)\n","# label_map_valid = { v:index for index, v in enumerate(df_valid.HS_Labels) }\n","# print(label_map_valid)\n","# train_dataset = BERTDataset(selected_dataset.train[DATA_COLUMN].to_list(),selected_dataset.train[LABEL_COLUMN].to_list(),model_name,max_len,label_map)\n","# test_dataset = BERTDataset(selected_dataset.test[DATA_COLUMN].to_list(),selected_dataset.test[LABEL_COLUMN].to_list(),model_name,max_len,label_map)\n","\n","train_dataset = BERTDataset(selected_dataset.train[DATA_COLUMN].to_list(),selected_dataset.train[LABEL_COLUMN].to_list(),model_name,max_len,label_map)\n","valid_dataset = BERTDataset(selected_dataset.valid[DATA_COLUMN].to_list(),selected_dataset.valid[LABEL_COLUMN].to_list(),model_name,max_len,label_map)\n","test_dataset = BERTDataset(selected_dataset.test[DATA_COLUMN].to_list(),selected_dataset.test[LABEL_COLUMN].to_list(),model_name,max_len,label_map)"],"execution_count":null,"outputs":[{"output_type":"stream","text":["{'OFF': 0, 'NOT_OFF': 1}\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"a3c6d32b0095424eb052d5150ba2ee19","version_minor":0,"version_major":2},"text/plain":["HBox(children=(FloatProgress(value=0.0, description='Downloading', max=701.0, style=ProgressStyle(description_…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"c96af1b6e3754af4b583f803553492b6","version_minor":0,"version_major":2},"text/plain":["HBox(children=(FloatProgress(value=0.0, description='Downloading', max=1099714.0, style=ProgressStyle(descript…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"f68c5f68dda645c68fe74594befc5fb8","version_minor":0,"version_major":2},"text/plain":["HBox(children=(FloatProgress(value=0.0, description='Downloading', max=112.0, style=ProgressStyle(description_…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"c6fcc928af284ddd9ea110889c498b03","version_minor":0,"version_major":2},"text/plain":["HBox(children=(FloatProgress(value=0.0, description='Downloading', max=376.0, style=ProgressStyle(description_…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"lt7l0IxjbmNu"},"source":["def model_init():\n","    return AutoModelForSequenceClassification.from_pretrained(model_name, return_dict=True, num_labels=len(label_map))"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"UYU6G4vWc5nz"},"source":["def compute_metrics(p): #p should be of type EvalPrediction\n","  preds = np.argmax(p.predictions, axis=1)\n","  assert len(preds) == len(p.label_ids)\n","  print(classification_report(p.label_ids,preds))\n","  print(confusion_matrix(p.label_ids,preds))\n","\n","  macro_f1_pos_neg = f1_score(p.label_ids,preds,average='macro',labels=[0,1])\n","  macro_f1 = f1_score(p.label_ids,preds,average='macro')\n","  macro_precision = precision_score(p.label_ids,preds,average='macro')\n","  macro_recall = recall_score(p.label_ids,preds,average='macro')\n","  acc = accuracy_score(p.label_ids,preds)\n","  return {\n","      'macro_f1' : macro_f1,\n","      'macro_f1_pos_neg' : macro_f1_pos_neg,  \n","      'macro_precision': macro_precision,\n","      'macro_recall': macro_recall,\n","      'accuracy': acc\n","  }"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"GnqiZOT37ByE"},"source":["# HyperParameter Search"]},{"cell_type":"markdown","metadata":{"id":"bJif-78C6Kmn"},"source":["you can change the batch size and gradient accumulation from here\n","\n"]},{"cell_type":"code","metadata":{"id":"L3Z_kPB-dE_w"},"source":["training_args = TrainingArguments(\"./train\")\n","training_args.evaluate_during_training = True\n","training_args.adam_epsilon = 1e-8\n","training_args.lr_scheduler_type = 'cosine'\n","training_args.fp16 = True\n","training_args.per_device_train_batch_size = 16\n","training_args.per_device_eval_batch_size = 16\n","training_args.gradient_accumulation_steps = 2\n","training_args.num_train_epochs= 8\n","training_args.evaluation_strategy = EvaluationStrategy.EPOCH\n","# training_args.logging_steps = 200\n","training_args.save_steps = 100000\n","# training_args.save_steps = \n","#training_args.eval_steps = \n","training_args.disable_tqdm = True\n","# print(\"Logging Step:\", training_args.logging_steps)\n","# print(\"Eval Step:\",training_args.eval_steps)"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"KeqRACPYheeb","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1620381102109,"user_tz":-180,"elapsed":38930,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"3a3bc50d-6062-4f3a-86b0-f33a7f85af52"},"source":["steps_per_epoch = (len(selected_dataset.train)// (training_args.per_device_train_batch_size * training_args.gradient_accumulation_steps))\n","total_steps = steps_per_epoch * training_args.num_train_epochs\n","print(steps_per_epoch)\n","print(total_steps)"],"execution_count":null,"outputs":[{"output_type":"stream","text":["218\n","1744\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"o8HOnY6odcwG","colab":{"base_uri":"https://localhost:8080/","height":171,"referenced_widgets":["149ad7b2ec754e0c8f3924f678f3cc94","aae3af7c1a944b05bf1209c2ad1c5764","a508edc945aa43d59b3b64369a6bb71e","0930eb7c66564861827846dfe0a81d48","d95c4b821670425e8e33a6d5d4ac5982","8e7ea19cd8c54887a1ee6e22ecc5eb6e","58b42dc870eb4e608817756c8a367c96","eee955b6c21340438e3b105ae9d16fbd"]},"executionInfo":{"status":"ok","timestamp":1620381131132,"user_tz":-180,"elapsed":67948,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"5f0d78e8-a01c-4398-9f09-998a021605f6"},"source":["trainer = Trainer(\n","    args=training_args,\n","    train_dataset=train_dataset, \n","    eval_dataset=valid_dataset, \n","    model_init=model_init,\n","    compute_metrics=compute_metrics,\n",")"],"execution_count":null,"outputs":[{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"149ad7b2ec754e0c8f3924f678f3cc94","version_minor":0,"version_major":2},"text/plain":["HBox(children=(FloatProgress(value=0.0, description='Downloading', max=654186400.0, style=ProgressStyle(descri…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"},{"output_type":"stream","text":["Some weights of the model checkpoint at UBC-NLP/MARBERT were not used when initializing BertForSequenceClassification: ['cls.predictions.bias', 'cls.predictions.transform.dense.weight', 'cls.predictions.transform.dense.bias', 'cls.predictions.transform.LayerNorm.weight', 'cls.predictions.transform.LayerNorm.bias', 'cls.predictions.decoder.weight', 'cls.seq_relationship.weight', 'cls.seq_relationship.bias']\n","- This IS expected if you are initializing BertForSequenceClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).\n","- This IS NOT expected if you are initializing BertForSequenceClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).\n","Some weights of BertForSequenceClassification were not initialized from the model checkpoint at UBC-NLP/MARBERT and are newly initialized: ['classifier.weight', 'classifier.bias']\n","You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.\n"],"name":"stderr"}]},{"cell_type":"code","metadata":{"id":"AFZ94M7Rzkhh","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1620381131133,"user_tz":-180,"elapsed":67942,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"c8dc74dc-ed3d-4e86-9466-59ca54945d37"},"source":["def my_hp_space(trial):\n","    return {\n","        \"learning_rate\": trial.suggest_float(\"learning_rate\", 2e-5, 7e-5, step=1e-5),\n","        \"seed\": trial.suggest_categorical(\"seed\", [0, 1, 42, 666, 123, 12345]),\n","        \"warmup_steps\": trial.suggest_int(\"warmup_steps\",0,total_steps*0.1,step=total_steps*0.1*0.5)\n","    }\n","\n","search_space = {\n","    \"learning_rate\":  list(np.arange(2e-5, 7e-5, 1e-5)),\n","    \"seed\":  [0, 1, 42, 666, 123, 12345],\n","    \"warmup_steps\": list(range(0, int((total_steps)*0.1)+1, int(total_steps*0.1*0.5)))\n","}\n","search_space"],"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["{'learning_rate': [2e-05,\n","  3.0000000000000004e-05,\n","  4.000000000000001e-05,\n","  5.000000000000001e-05,\n","  6.000000000000001e-05],\n"," 'seed': [0, 1, 42, 666, 123, 12345],\n"," 'warmup_steps': [0, 87, 174]}"]},"metadata":{"tags":[]},"execution_count":33}]},{"cell_type":"code","metadata":{"id":"PgfU2UVzfS_A"},"source":["def my_objective(metrics):\n","    return metrics['eval_macro_f1']"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"nc4gOvtE66Mj"},"source":["choose a study name to save it on disk"]},{"cell_type":"code","metadata":{"id":"NSGLnBKv64sZ"},"source":["# name = \"qarib-semeval\""],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"7l821sW7fdaY"},"source":["# best_run = trainer.hyperparameter_search(direction=\"maximize\",\n","#                                          hp_space=my_hp_space,\n","#                                          compute_objective=my_objective,\n","#                                          n_trials=None,\n","#                                          pruner=optuna.pruners.NopPruner(),\n","#                                          sampler=optuna.samplers.GridSampler(search_space),\n","#                                          study_name=name,\n","#                                          storage=\"sqlite:////content/drive/MyDrive/{}.db\".format(name),\n","#                                          load_if_exists=False # you can change this to true, for continuing the search\n","#                                          )"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"OVwfM9ZJf12t"},"source":["# best_run"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"vTmvFEs41WkV"},"source":["#Regular Training"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"kTLYpWADhZPq","executionInfo":{"status":"ok","timestamp":1620381131136,"user_tz":-180,"elapsed":67933,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"32951586-7d56-4698-ebc8-ac74955c3ccd"},"source":["training_args = TrainingArguments(\"./train\")\n","training_args.evaluate_during_training = True\n","training_args.adam_epsilon = 1e-8\n","training_args.learning_rate = 5e-5\n","training_args.fp16 = True\n","training_args.per_device_train_batch_size = 16\n","training_args.per_device_eval_batch_size = 16\n","training_args.gradient_accumulation_steps = 2\n","training_args.num_train_epochs= 8\n","\n","\n","steps_per_epoch = (len(selected_dataset.train)// (training_args.per_device_train_batch_size * training_args.gradient_accumulation_steps))\n","total_steps = steps_per_epoch * training_args.num_train_epochs\n","print(steps_per_epoch)\n","print(total_steps)\n","#Warmup_ratio\n","warmup_ratio = 0.1\n","training_args.warmup_steps = total_steps*warmup_ratio # or you can set the warmup steps directly \n","\n","training_args.evaluation_strategy = EvaluationStrategy.EPOCH\n","# training_args.logging_steps = 200\n","training_args.save_steps = 100000 #don't want to save any model, there is probably a better way to do this :)\n","training_args.seed = 42\n","training_args.disable_tqdm = False\n","training_args.lr_scheduler_type = 'cosine'"],"execution_count":null,"outputs":[{"output_type":"stream","text":["218\n","1744\n"],"name":"stdout"}]},{"cell_type":"markdown","metadata":{"id":"V_oGjIC-7Vow"},"source":["This paert allows you to do a regular training with no hyper parameter optimization"]},{"cell_type":"code","metadata":{"id":"Ro5BW5ak4uc1","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1620381135978,"user_tz":-180,"elapsed":72769,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"e3580453-1a72-4a1f-d7cf-2f5fde98a0fd"},"source":["trainer = Trainer(\n","    model = model_init(),\n","    args = training_args,\n","    train_dataset = train_dataset,\n","    eval_dataset=valid_dataset,\n","    compute_metrics=compute_metrics,\n",")"],"execution_count":null,"outputs":[{"output_type":"stream","text":["Some weights of the model checkpoint at UBC-NLP/MARBERT were not used when initializing BertForSequenceClassification: ['cls.predictions.bias', 'cls.predictions.transform.dense.weight', 'cls.predictions.transform.dense.bias', 'cls.predictions.transform.LayerNorm.weight', 'cls.predictions.transform.LayerNorm.bias', 'cls.predictions.decoder.weight', 'cls.seq_relationship.weight', 'cls.seq_relationship.bias']\n","- This IS expected if you are initializing BertForSequenceClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).\n","- This IS NOT expected if you are initializing BertForSequenceClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).\n","Some weights of BertForSequenceClassification were not initialized from the model checkpoint at UBC-NLP/MARBERT and are newly initialized: ['classifier.weight', 'classifier.bias']\n","You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.\n"],"name":"stderr"}]},{"cell_type":"code","metadata":{"id":"yx336O3J2SdQ","colab":{"base_uri":"https://localhost:8080/","height":1000},"executionInfo":{"status":"ok","timestamp":1620382168804,"user_tz":-180,"elapsed":1105589,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"94458595-4b2a-4177-fef4-75f3d4431a11"},"source":["trainer.train()"],"execution_count":null,"outputs":[{"output_type":"display_data","data":{"text/html":["\n","    <div>\n","        <style>\n","            /* Turns off some styling */\n","            progress {\n","                /* gets rid of default border in Firefox and Opera. */\n","                border: none;\n","                /* Needs to be in here for Safari polyfill so background images work as expected. */\n","                background-size: auto;\n","            }\n","        </style>\n","      \n","      <progress value='1744' max='1744' style='width:300px; height:20px; vertical-align: middle;'></progress>\n","      [1744/1744 17:11, Epoch 7/8]\n","    </div>\n","    <table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: left;\">\n","      <th>Epoch</th>\n","      <th>Training Loss</th>\n","      <th>Validation Loss</th>\n","      <th>Macro F1</th>\n","      <th>Macro F1 Pos Neg</th>\n","      <th>Macro Precision</th>\n","      <th>Macro Recall</th>\n","      <th>Accuracy</th>\n","      <th>Runtime</th>\n","      <th>Samples Per Second</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <td>0</td>\n","      <td>No log</td>\n","      <td>0.192108</td>\n","      <td>0.876417</td>\n","      <td>0.876417</td>\n","      <td>0.846215</td>\n","      <td>0.922274</td>\n","      <td>0.919000</td>\n","      <td>6.057600</td>\n","      <td>165.083000</td>\n","    </tr>\n","    <tr>\n","      <td>1</td>\n","      <td>No log</td>\n","      <td>0.205861</td>\n","      <td>0.895633</td>\n","      <td>0.895633</td>\n","      <td>0.904977</td>\n","      <td>0.887009</td>\n","      <td>0.940000</td>\n","      <td>6.108700</td>\n","      <td>163.702000</td>\n","    </tr>\n","    <tr>\n","      <td>2</td>\n","      <td>0.203900</td>\n","      <td>0.324151</td>\n","      <td>0.885829</td>\n","      <td>0.885829</td>\n","      <td>0.875902</td>\n","      <td>0.896818</td>\n","      <td>0.931000</td>\n","      <td>6.123800</td>\n","      <td>163.297000</td>\n","    </tr>\n","    <tr>\n","      <td>3</td>\n","      <td>0.203900</td>\n","      <td>0.365604</td>\n","      <td>0.895439</td>\n","      <td>0.895439</td>\n","      <td>0.892088</td>\n","      <td>0.898897</td>\n","      <td>0.938000</td>\n","      <td>6.111300</td>\n","      <td>163.632000</td>\n","    </tr>\n","    <tr>\n","      <td>4</td>\n","      <td>0.035800</td>\n","      <td>0.370080</td>\n","      <td>0.890500</td>\n","      <td>0.890500</td>\n","      <td>0.876452</td>\n","      <td>0.906773</td>\n","      <td>0.933000</td>\n","      <td>6.130300</td>\n","      <td>163.125000</td>\n","    </tr>\n","    <tr>\n","      <td>5</td>\n","      <td>0.035800</td>\n","      <td>0.496805</td>\n","      <td>0.870853</td>\n","      <td>0.870853</td>\n","      <td>0.900588</td>\n","      <td>0.847546</td>\n","      <td>0.929000</td>\n","      <td>6.116500</td>\n","      <td>163.492000</td>\n","    </tr>\n","    <tr>\n","      <td>6</td>\n","      <td>0.003400</td>\n","      <td>0.450609</td>\n","      <td>0.884673</td>\n","      <td>0.884673</td>\n","      <td>0.895752</td>\n","      <td>0.874618</td>\n","      <td>0.934000</td>\n","      <td>6.138400</td>\n","      <td>162.910000</td>\n","    </tr>\n","    <tr>\n","      <td>7</td>\n","      <td>0.003400</td>\n","      <td>0.452972</td>\n","      <td>0.884673</td>\n","      <td>0.884673</td>\n","      <td>0.895752</td>\n","      <td>0.874618</td>\n","      <td>0.934000</td>\n","      <td>6.111100</td>\n","      <td>163.638000</td>\n","    </tr>\n","  </tbody>\n","</table><p>"],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["              precision    recall  f1-score   support\n","\n","           0       0.71      0.93      0.80       179\n","           1       0.98      0.92      0.95       821\n","\n","    accuracy                           0.92      1000\n","   macro avg       0.85      0.92      0.88      1000\n","weighted avg       0.93      0.92      0.92      1000\n","\n","[[166  13]\n"," [ 68 753]]\n","              precision    recall  f1-score   support\n","\n","           0       0.85      0.80      0.83       179\n","           1       0.96      0.97      0.96       821\n","\n","    accuracy                           0.94      1000\n","   macro avg       0.90      0.89      0.90      1000\n","weighted avg       0.94      0.94      0.94      1000\n","\n","[[144  35]\n"," [ 25 796]]\n","              precision    recall  f1-score   support\n","\n","           0       0.79      0.84      0.81       179\n","           1       0.97      0.95      0.96       821\n","\n","    accuracy                           0.93      1000\n","   macro avg       0.88      0.90      0.89      1000\n","weighted avg       0.93      0.93      0.93      1000\n","\n","[[151  28]\n"," [ 41 780]]\n","              precision    recall  f1-score   support\n","\n","           0       0.82      0.84      0.83       179\n","           1       0.96      0.96      0.96       821\n","\n","    accuracy                           0.94      1000\n","   macro avg       0.89      0.90      0.90      1000\n","weighted avg       0.94      0.94      0.94      1000\n","\n","[[150  29]\n"," [ 33 788]]\n","              precision    recall  f1-score   support\n","\n","           0       0.78      0.87      0.82       179\n","           1       0.97      0.95      0.96       821\n","\n","    accuracy                           0.93      1000\n","   macro avg       0.88      0.91      0.89      1000\n","weighted avg       0.94      0.93      0.93      1000\n","\n","[[155  24]\n"," [ 43 778]]\n","              precision    recall  f1-score   support\n","\n","           0       0.86      0.72      0.78       179\n","           1       0.94      0.97      0.96       821\n","\n","    accuracy                           0.93      1000\n","   macro avg       0.90      0.85      0.87      1000\n","weighted avg       0.93      0.93      0.93      1000\n","\n","[[129  50]\n"," [ 21 800]]\n","              precision    recall  f1-score   support\n","\n","           0       0.84      0.78      0.81       179\n","           1       0.95      0.97      0.96       821\n","\n","    accuracy                           0.93      1000\n","   macro avg       0.90      0.87      0.88      1000\n","weighted avg       0.93      0.93      0.93      1000\n","\n","[[140  39]\n"," [ 27 794]]\n","              precision    recall  f1-score   support\n","\n","           0       0.84      0.78      0.81       179\n","           1       0.95      0.97      0.96       821\n","\n","    accuracy                           0.93      1000\n","   macro avg       0.90      0.87      0.88      1000\n","weighted avg       0.93      0.93      0.93      1000\n","\n","[[140  39]\n"," [ 27 794]]\n"],"name":"stdout"},{"output_type":"execute_result","data":{"text/plain":["TrainOutput(global_step=1744, training_loss=0.06972350928411229, metrics={'train_runtime': 1032.7015, 'train_samples_per_second': 1.689, 'total_flos': 13973076111433728, 'epoch': 8.0})"]},"metadata":{"tags":[]},"execution_count":40}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":377},"id":"agqaiJStrc_w","executionInfo":{"status":"ok","timestamp":1620382180906,"user_tz":-180,"elapsed":1117683,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"ee9f416c-f753-4c55-f907-565eb0d1382d"},"source":["trainer.evaluate(test_dataset)"],"execution_count":null,"outputs":[{"output_type":"display_data","data":{"text/html":["\n","    <div>\n","        <style>\n","            /* Turns off some styling */\n","            progress {\n","                /* gets rid of default border in Firefox and Opera. */\n","                border: none;\n","                /* Needs to be in here for Safari polyfill so background images work as expected. */\n","                background-size: auto;\n","            }\n","        </style>\n","      \n","      <progress value='125' max='125' style='width:300px; height:20px; vertical-align: middle;'></progress>\n","      [125/125 00:12]\n","    </div>\n","    "],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["              precision    recall  f1-score   support\n","\n","           0       0.88      0.76      0.82       402\n","           1       0.94      0.97      0.96      1598\n","\n","    accuracy                           0.93      2000\n","   macro avg       0.91      0.87      0.89      2000\n","weighted avg       0.93      0.93      0.93      2000\n","\n","[[ 307   95]\n"," [  42 1556]]\n"],"name":"stdout"},{"output_type":"execute_result","data":{"text/plain":["{'epoch': 8.0,\n"," 'eval_accuracy': 0.9315,\n"," 'eval_loss': 0.5021129250526428,\n"," 'eval_macro_f1': 0.8877048720101934,\n"," 'eval_macro_f1_pos_neg': 0.8877048720101934,\n"," 'eval_macro_precision': 0.9110576380729574,\n"," 'eval_macro_recall': 0.8686993692364211,\n"," 'eval_runtime': 12.1931,\n"," 'eval_samples_per_second': 164.028}"]},"metadata":{"tags":[]},"execution_count":41}]},{"cell_type":"code","metadata":{"id":"RrmCpsROvS-z"},"source":["# df_test_labels.columns = [LABEL_COLUMN]\n","# test_dataset = BERTDataset(selected_dataset.test[DATA_COLUMN].to_list(),selected_dataset.df_test_labels[LABEL_COLUMN].to_list(),model_name,max_len,label_map)"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"Seyz8Yaj2ZCK"},"source":["trainer.save_model(\"SOME_PATH\")"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"xd1iuK-UFjEV"},"source":[""],"execution_count":null,"outputs":[]}]}
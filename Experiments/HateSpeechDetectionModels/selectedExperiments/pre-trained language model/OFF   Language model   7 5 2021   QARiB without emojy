{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"name":"off | Language model | 7/5/2021 | QARiB without emojy","provenance":[{"file_id":"1mwyOGZsoZeODQ1c8n34oiekc9byIcv4N","timestamp":1620334437698},{"file_id":"1P9iQHtUH5KUbTVtp8B4-AopZzEEPE0lw","timestamp":1618868148454}],"collapsed_sections":[]},"kernelspec":{"name":"python3","display_name":"Python 3"},"accelerator":"GPU","widgets":{"application/vnd.jupyter.widget-state+json":{"e0d38a860e954197ad097cbdd8f0ff01":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_8b618bd08d704f97a46424e190988945","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_c5b3ef3845594ddfbf52cfd08df56738","IPY_MODEL_df1f3d98a022447c8ddf9cf95c73be5c"]}},"8b618bd08d704f97a46424e190988945":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"c5b3ef3845594ddfbf52cfd08df56738":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_8668c2146ae2406fa9b65f5ad59fe246","_dom_classes":[],"description":"Downloading: 100%","_model_name":"FloatProgressModel","bar_style":"success","max":576,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":576,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_97130214138141aa8dd7bc674316ea89"}},"df1f3d98a022447c8ddf9cf95c73be5c":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_12385897f2464530a286f49a0f9e425f","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 576/576 [00:01&lt;00:00, 346B/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_852df5dfba054fc1912afbe0dfddc97a"}},"8668c2146ae2406fa9b65f5ad59fe246":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"97130214138141aa8dd7bc674316ea89":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"12385897f2464530a286f49a0f9e425f":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"852df5dfba054fc1912afbe0dfddc97a":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"626c6d6d2abd4ebfa69b161a597019f2":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_d7d4909f4e394f318716d9892ba5ea0a","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_3ed4633c63054627b828c4018a52d9a7","IPY_MODEL_962a28c003a443d89d98840d657e7463"]}},"d7d4909f4e394f318716d9892ba5ea0a":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"3ed4633c63054627b828c4018a52d9a7":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_ab32b2b3d85f47258d4aa8cbcd56da84","_dom_classes":[],"description":"Downloading: 100%","_model_name":"FloatProgressModel","bar_style":"success","max":717711,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":717711,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_f303fc1d6d3e46f9ac6d63fcce44d178"}},"962a28c003a443d89d98840d657e7463":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_4f2e29f519e54766af89008c5ec63181","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 718k/718k [00:01&lt;00:00, 599kB/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_6f384d0b58534dc6bd6975493c25254a"}},"ab32b2b3d85f47258d4aa8cbcd56da84":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"f303fc1d6d3e46f9ac6d63fcce44d178":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"4f2e29f519e54766af89008c5ec63181":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"6f384d0b58534dc6bd6975493c25254a":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"a5250298358146298124eab824f7f099":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_e721de6a21fc46ffaf068611c90af8cc","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_6d9dd5acc12d4ceabebb05e5b4311f62","IPY_MODEL_eb683c64958b4be28e4e350072d1f38f"]}},"e721de6a21fc46ffaf068611c90af8cc":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"6d9dd5acc12d4ceabebb05e5b4311f62":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_5bdb921bb7024c3ca7b227d75da9493c","_dom_classes":[],"description":"Downloading: 100%","_model_name":"FloatProgressModel","bar_style":"success","max":543452854,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":543452854,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_7a288c5a7c0c45f28209e3cd99c18c9d"}},"eb683c64958b4be28e4e350072d1f38f":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_61836f8c343a4e349f5e8c8447925a05","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 543M/543M [00:15&lt;00:00, 36.0MB/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_74024e2426c64c4fa75f33a9129215e4"}},"5bdb921bb7024c3ca7b227d75da9493c":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"7a288c5a7c0c45f28209e3cd99c18c9d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"61836f8c343a4e349f5e8c8447925a05":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"74024e2426c64c4fa75f33a9129215e4":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}}}}},"cells":[{"cell_type":"markdown","metadata":{"id":"g4mZ8KYblg-g"},"source":["#installing dependencies"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"IbHOBNd4ETRD","executionInfo":{"status":"ok","timestamp":1620334588919,"user_tz":-180,"elapsed":29522,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"466092ef-97b0-4cb7-8b2b-7947f42bc94b"},"source":["from google.colab import drive\n","drive.mount('/content/drive')\n"],"execution_count":1,"outputs":[{"output_type":"stream","text":["Mounted at /content/drive\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"C4tlwQ8si_FI","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1620334605577,"user_tz":-180,"elapsed":4722,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"13ec14e8-be05-4b9b-90f5-de52755ca69f"},"source":["import torch\n","\n","# If there's a GPU available...\n","if torch.cuda.is_available():    \n","\n","    # Tell PyTorch to use the GPU.    \n","    device = torch.device(\"cuda\")\n","\n","    print('There are %d GPU(s) available.' % torch.cuda.device_count())\n","\n","    print('We will use the GPU:', torch.cuda.get_device_name(0))\n","    !nvidia-smi\n","\n","# If not...\n","else:\n","    print('No GPU available, using the CPU instead.')\n","    device = torch.device(\"cpu\")"],"execution_count":2,"outputs":[{"output_type":"stream","text":["There are 1 GPU(s) available.\n","We will use the GPU: Tesla T4\n","Thu May  6 20:56:45 2021       \n","+-----------------------------------------------------------------------------+\n","| NVIDIA-SMI 465.19.01    Driver Version: 460.32.03    CUDA Version: 11.2     |\n","|-------------------------------+----------------------+----------------------+\n","| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n","| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n","|                               |                      |               MIG M. |\n","|===============================+======================+======================|\n","|   0  Tesla T4            Off  | 00000000:00:04.0 Off |                    0 |\n","| N/A   57C    P8    11W /  70W |      3MiB / 15109MiB |      0%      Default |\n","|                               |                      |                  N/A |\n","+-------------------------------+----------------------+----------------------+\n","                                                                               \n","+-----------------------------------------------------------------------------+\n","| Processes:                                                                  |\n","|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |\n","|        ID   ID                                                   Usage      |\n","|=============================================================================|\n","|  No running processes found                                                 |\n","+-----------------------------------------------------------------------------+\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"y024z5AnlTLz","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1620334631725,"user_tz":-180,"elapsed":22358,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"fdab7281-ac7d-4f5d-fd0e-73d90cb10826"},"source":["!pip install -q optuna==2.3.0\n","!pip install -q transformers==4.2.1\n","# !pip install farasapy\n","# !pip install pyarabic\n","!git clone https://huggingface.co/qarib/bert-base-qarib"],"execution_count":3,"outputs":[{"output_type":"stream","text":["\u001b[?25l\r\u001b[K     |█▎                              | 10kB 22.2MB/s eta 0:00:01\r\u001b[K     |██▌                             | 20kB 20.1MB/s eta 0:00:01\r\u001b[K     |███▉                            | 30kB 11.3MB/s eta 0:00:01\r\u001b[K     |█████                           | 40kB 8.1MB/s eta 0:00:01\r\u001b[K     |██████▍                         | 51kB 6.2MB/s eta 0:00:01\r\u001b[K     |███████▋                        | 61kB 6.7MB/s eta 0:00:01\r\u001b[K     |████████▉                       | 71kB 7.2MB/s eta 0:00:01\r\u001b[K     |██████████▏                     | 81kB 7.6MB/s eta 0:00:01\r\u001b[K     |███████████▍                    | 92kB 8.3MB/s eta 0:00:01\r\u001b[K     |████████████▊                   | 102kB 8.1MB/s eta 0:00:01\r\u001b[K     |██████████████                  | 112kB 8.1MB/s eta 0:00:01\r\u001b[K     |███████████████▏                | 122kB 8.1MB/s eta 0:00:01\r\u001b[K     |████████████████▌               | 133kB 8.1MB/s eta 0:00:01\r\u001b[K     |█████████████████▊              | 143kB 8.1MB/s eta 0:00:01\r\u001b[K     |███████████████████             | 153kB 8.1MB/s eta 0:00:01\r\u001b[K     |████████████████████▎           | 163kB 8.1MB/s eta 0:00:01\r\u001b[K     |█████████████████████▌          | 174kB 8.1MB/s eta 0:00:01\r\u001b[K     |██████████████████████▉         | 184kB 8.1MB/s eta 0:00:01\r\u001b[K     |████████████████████████        | 194kB 8.1MB/s eta 0:00:01\r\u001b[K     |█████████████████████████▍      | 204kB 8.1MB/s eta 0:00:01\r\u001b[K     |██████████████████████████▋     | 215kB 8.1MB/s eta 0:00:01\r\u001b[K     |███████████████████████████▉    | 225kB 8.1MB/s eta 0:00:01\r\u001b[K     |█████████████████████████████▏  | 235kB 8.1MB/s eta 0:00:01\r\u001b[K     |██████████████████████████████▍ | 245kB 8.1MB/s eta 0:00:01\r\u001b[K     |███████████████████████████████▊| 256kB 8.1MB/s eta 0:00:01\r\u001b[K     |████████████████████████████████| 266kB 8.1MB/s \n","\u001b[?25h  Installing build dependencies ... \u001b[?25l\u001b[?25hdone\n","  Getting requirements to build wheel ... \u001b[?25l\u001b[?25hdone\n","    Preparing wheel metadata ... \u001b[?25l\u001b[?25hdone\n","\u001b[K     |████████████████████████████████| 81kB 6.9MB/s \n","\u001b[K     |████████████████████████████████| 174kB 7.6MB/s \n","\u001b[K     |████████████████████████████████| 112kB 12.5MB/s \n","\u001b[K     |████████████████████████████████| 143kB 12.3MB/s \n","\u001b[K     |████████████████████████████████| 51kB 6.8MB/s \n","\u001b[K     |████████████████████████████████| 81kB 6.5MB/s \n","\u001b[?25h  Building wheel for optuna (PEP 517) ... \u001b[?25l\u001b[?25hdone\n","  Building wheel for pyperclip (setup.py) ... \u001b[?25l\u001b[?25hdone\n","\u001b[K     |████████████████████████████████| 1.8MB 10.3MB/s \n","\u001b[K     |████████████████████████████████| 2.9MB 48.1MB/s \n","\u001b[K     |████████████████████████████████| 901kB 48.2MB/s \n","\u001b[?25hCloning into 'bert-base-qarib'...\n","remote: Enumerating objects: 56, done.\u001b[K\n","remote: Counting objects: 100% (56/56), done.\u001b[K\n","remote: Compressing objects: 100% (55/55), done.\u001b[K\n","remote: Total 56 (delta 26), reused 0 (delta 0)\u001b[K\n","Unpacking objects: 100% (56/56), done.\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"krBvefg6l6vv","executionInfo":{"status":"ok","timestamp":1620334639061,"user_tz":-180,"elapsed":1011,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}}},"source":["!mkdir data\n","!mkdir train"],"execution_count":4,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"TVay9KamnC3I"},"source":["#Creating training datasets"]},{"cell_type":"code","metadata":{"id":"hr84ozGinCFh","executionInfo":{"status":"ok","timestamp":1620334643539,"user_tz":-180,"elapsed":1359,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}}},"source":["import pandas as pd\n","import numpy as np\n","import re\n","\n","from tqdm import tqdm_notebook as tqdm\n","from sklearn.model_selection import train_test_split\n","all_datasets= []"],"execution_count":5,"outputs":[]},{"cell_type":"code","metadata":{"id":"8PhWP2JzrEci","executionInfo":{"status":"ok","timestamp":1620334646917,"user_tz":-180,"elapsed":1408,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}}},"source":["class Dataset:\n","    def __init__(\n","        self,\n","        name,\n","        train,\n","        valid,\n","        test,\n","        label_list,\n","        # label_list_valid,\n","        # label_list_test\n","    ):\n","        self.name = name\n","        self.train = train\n","        self.valid = valid\n","        self.test = test\n","        self.label_list = label_list\n","        # self.label_list_valid = label_list_valid\n","        # self.label_list_test = label_list_test"],"execution_count":6,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"joWPYWGMqLau"},"source":["##Semeval Dataset "]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"FfGUqQKieK7W","executionInfo":{"status":"ok","timestamp":1620334736736,"user_tz":-180,"elapsed":7487,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"da3875e8-9918-4d19-cf1f-1271df2561af"},"source":["!pip install -q prenlp\n","from prenlp.data import Normalizer\n","normalizer = Normalizer(url_repl='[URL]', tag_repl='[TAG]', emoji_repl='[EMOJI]', email_repl='[EMAIL]', tel_repl='[TEL]', image_repl='[IMG]')"],"execution_count":7,"outputs":[{"output_type":"stream","text":["\u001b[K     |████████████████████████████████| 51kB 6.2MB/s \n","\u001b[K     |████████████████████████████████| 19.4MB 1.2MB/s \n","\u001b[K     |████████████████████████████████| 1.2MB 45.1MB/s \n","\u001b[K     |████████████████████████████████| 133kB 54.3MB/s \n","\u001b[K     |████████████████████████████████| 92kB 12.3MB/s \n","\u001b[K     |████████████████████████████████| 460kB 49.2MB/s \n","\u001b[?25h"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"lt_lGy85zuca","executionInfo":{"status":"ok","timestamp":1620334811220,"user_tz":-180,"elapsed":708,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}}},"source":["text_cleaning_re = \"[a-zA-Z]|\\d+|[٠١٢٣٤٥٦٧٨٩]|[.#،<>:@,\\\\-_”“٪ًَ]\"\n","def preprocess(text):\n","  # search = [\"أ\",\"إ\",\"آ\",\"ة\",\"_\",\"-\",\"/\",\".\",\"،\",\" و \",\" يا \",'\"',\"ـ\",\"'\",\"ى\",\"\\\\\",'\\n', '\\t','&quot;','?','؟','!','#']\n","  # replace = [\"ا\",\"ا\",\"ا\",\"ه\",\" \",\" \",\"\",\"\",\"\",\" و\",\" يا\",\"\",\"\",\"\",\"ي\",\"\",' ', ' ',' ',' ? ',' ؟ ',' ! ',' ']\n","  #remove tashkeel\n","  p_tashkeel = re.compile(r'[\\u0617-\\u061A\\u064B-\\u0652]')\n","  text = re.sub(p_tashkeel,\"\", str(text))\n","  # text = text.replace('وو', 'و')\n","  # text = text.replace('يي', 'ي')\n","  # text = text.replace('اا', 'ا')\n","  text = re.sub(text_cleaning_re, ' ', str(text).lower()).strip()\n","  #remove longation\n","  text = re.sub(r'(.)\\1+', r'\\1\\1', str(text)) \n","  text = re.sub(\"[إأآا]\", \"ا\", str(text))\n","  text = re.sub(\"ى\", \"ي\", str(text))\n","  # text = re.sub(\"ؤ\", \"ء\", text)\n","  # text = re.sub(\"ئ\", \"ء\", text)\n","  text = re.sub(\"ة\", \"ه\", str(text))\n","  # for i in range(0, len(search)):\n","  #       text = text.replace(search[i], replace[i])\n","  \n","   #trim    \n","  # text = text.strip()\n","  text =normalizer.normalize(text)\n","  tokens = []\n","  for token in text.split():\n","    # if token not in stop_words:\n","      tokens.append(token)\n","  return \" \".join(tokens)"],"execution_count":9,"outputs":[]},{"cell_type":"code","metadata":{"id":"-6oL3qkXmOgJ","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1620335115182,"user_tz":-180,"elapsed":1806,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"8845f6a1-ece3-4d07-eeda-517d25136852"},"source":["#load dataset\n","df_train = pd.read_excel(\"/content/drive/MyDrive/MasterThesis/DataSet-forUsing/semeval2020/train.xlsx\")\n","df_valid = pd.read_excel('/content/drive/MyDrive/MasterThesis/DataSet-forUsing/semeval2020/dev.xlsx')\n","df_test_tweets = pd.read_excel('/content/drive/MyDrive/MasterThesis/DataSet-forUsing/semeval2020/test.xlsx')\n","df_test_labels = pd.read_excel('/content/drive/MyDrive/MasterThesis/DataSet-forUsing/semeval2020/offLabel.xlsx')\n","\n","#Rename Columns\n","df_train = df_train.rename(columns={'off': 'OFF_Labels','hs': 'HS_Labels'})\n","df_valid = df_valid.rename(columns={'off': 'OFF_Labels','hs': 'HS_Labels'})\n","df_test_labels=df_test_labels.rename(columns={'labels':'OFF_Labels'})\n","\n","df_test=pd.concat([df_test_tweets, df_test_labels], axis=1)\n","\n","#drop any row have null values\n","df_train=df_train.dropna(how='any',axis=0)\n","df_valid=df_valid.dropna(how='any',axis=0)\n","df_train.drop(columns=['HS_Labels'])\n","df_valid.drop(columns=['HS_Labels'])\n","\n","# ----------------------------------------------------------------- #\n","DATA_COLUMN = \"tweets\"\n","LABEL_COLUMN = \"OFF_Labels\"\n","\n","# ----------------------------------------------------------------- #\n","\n","df_train = df_train[['tweets','OFF_Labels']]\n","df_valid = df_valid[['tweets','OFF_Labels']]\n","df_test = df_test[['tweets','OFF_Labels']]\n","df_train.columns = [DATA_COLUMN, LABEL_COLUMN]\n","df_valid.columns = [DATA_COLUMN, LABEL_COLUMN]\n","df_test.columns = [DATA_COLUMN,LABEL_COLUMN]\n","# df_test_labels.columns = [LABEL_COLUMN]\n","print(df_train[LABEL_COLUMN].value_counts())\n","print(df_valid[LABEL_COLUMN].value_counts())\n","print(df_test[LABEL_COLUMN].value_counts())\n","\n","\n","label_list_semeval = ['OFF','NOT_OFF']\n","data_semeval = Dataset(\"Data-semeval\", df_train, df_valid,df_test,label_list_semeval)\n","all_datasets.append(data_semeval)\n","\n","# ----------------------------------------------------------------- #\n","\n"],"execution_count":13,"outputs":[{"output_type":"stream","text":["NOT_OFF    5576\n","OFF        1408\n","Name: OFF_Labels, dtype: int64\n","NOT_OFF    821\n","OFF        179\n","Name: OFF_Labels, dtype: int64\n","NOT_OFF    1598\n","OFF         402\n","Name: OFF_Labels, dtype: int64\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"-WYy5ikAs7l3","colab":{"base_uri":"https://localhost:8080/","height":687,"output_embedded_package_id":"17vs33Z7kYb_d4Bg88GoB0iOY0znr1Er_"},"executionInfo":{"status":"ok","timestamp":1620335127220,"user_tz":-180,"elapsed":4060,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"47f01437-0f76-4a50-bc7b-66c6168fbcd1"},"source":["%load_ext google.colab.data_table\n","df_train"],"execution_count":14,"outputs":[{"output_type":"display_data","data":{"text/plain":"Output hidden; open in https://colab.research.google.com to view."},"metadata":{}}]},{"cell_type":"code","metadata":{"id":"lI2kEqe50_s4"},"source":["# train_sentence_length = [ len(text.split()) for text in df_train['tweets']]\n","# valid_sentence_length = [ len(text.split()) for text in df_valid['tweets']]\n","# test_sentence_length = [ len(text.split()) for text in df_test['tweets']]\n","\n","# print(\"Max of train len: \",np.max(train_sentence_length))\n","# print(\"Max of test len: \",np.max(valid_sentence_length))\n","# print(\"Max of test len: \",np.max(test_sentence_length))\n","# import matplotlib.pyplot as plt\n","\n","# plt.hist(train_sentence_length,bins= range(200),density=True)\n","# plt.hist(valid_sentence_length,bins= range(200),density=True)\n","# plt.hist(test_sentence_length,bins= range(200),density=True)\n","# plt.show()"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"Bcwdslw7v0Q8"},"source":["#Trainer"]},{"cell_type":"code","metadata":{"id":"HUn2RB6Bvrxj","executionInfo":{"status":"ok","timestamp":1620335135781,"user_tz":-180,"elapsed":4583,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}}},"source":["from transformers import AutoTokenizer, AutoModelForMaskedLM,BertForSequenceClassification,AutoModel\n","import numpy as np\n","from sklearn.metrics import classification_report, accuracy_score, f1_score, confusion_matrix, precision_score , recall_score\n","\n","from transformers import AutoConfig, AutoModelForSequenceClassification, AutoTokenizer, BertTokenizer\n","from transformers.data.processors import SingleSentenceClassificationProcessor\n","from transformers import Trainer , TrainingArguments\n","from transformers.trainer_utils import EvaluationStrategy\n","from transformers.data.processors.utils import InputFeatures\n","from torch.utils.data import Dataset\n","from torch.utils.data import DataLoader\n","from sklearn.utils import resample\n","import logging\n","import torch\n","import optuna \n","# from arabert.preprocess_arabert import preprocess, never_split_tokens\n"],"execution_count":15,"outputs":[]},{"cell_type":"code","metadata":{"id":"KfNKr05tv7cA","executionInfo":{"status":"ok","timestamp":1620335138057,"user_tz":-180,"elapsed":977,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}}},"source":["logging.basicConfig(level=logging.WARNING)\n","logger = logging.getLogger(__name__)"],"execution_count":16,"outputs":[]},{"cell_type":"code","metadata":{"id":"R4SGYoB2EDJD","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1620335141228,"user_tz":-180,"elapsed":839,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"de127351-6392-4dd6-d021-875c88183ec5"},"source":["for x in all_datasets:\n","  print(x.name)"],"execution_count":17,"outputs":[{"output_type":"stream","text":["Data-semeval\n"],"name":"stdout"}]},{"cell_type":"markdown","metadata":{"id":"62Lma6tT5zJi"},"source":["You can choose which model, and dataset from here along with the max sentence length"]},{"cell_type":"code","metadata":{"id":"vzeVFoz1wDYf","executionInfo":{"status":"ok","timestamp":1620335146530,"user_tz":-180,"elapsed":758,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}}},"source":["dataset_name = 'Data-semeval'\n","# model_name = 'qarib/bert-base-qarib'\n","# https://huggingface.co/UBC-NLP/MARBERT\n","model_name = 'qarib/bert-base-qarib'\n","task_name = 'classification'\n","# num_labels = 2\n","max_len = 256\n"],"execution_count":18,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"tcbD2PCiX4vw","executionInfo":{"status":"ok","timestamp":1620335149190,"user_tz":-180,"elapsed":980,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"239a406e-b846-44f6-aad8-67bb088161ee"},"source":["for d in all_datasets:\n","  if d.name==dataset_name:\n","    selected_dataset = d\n","    print('Dataset found \\n',dataset_name)\n","    break"],"execution_count":19,"outputs":[{"output_type":"stream","text":["Dataset found \n"," Data-semeval\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"PoyaRIGYCEzh","executionInfo":{"status":"ok","timestamp":1620335172368,"user_tz":-180,"elapsed":15873,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}}},"source":["# arabert_prep = ArabertPreprocessor(model_name.split(\"/\")[-1])\n","\n","selected_dataset.train[DATA_COLUMN] = selected_dataset.train[DATA_COLUMN].apply(lambda x:   preprocess(x))\n","selected_dataset.valid[DATA_COLUMN] = selected_dataset.valid[DATA_COLUMN].apply(lambda x:   preprocess(x))\n","selected_dataset.test[DATA_COLUMN] = selected_dataset.test[DATA_COLUMN].apply(lambda x:  preprocess(x))  "],"execution_count":20,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"WE_MmGDceJxj","executionInfo":{"status":"ok","timestamp":1620335194009,"user_tz":-180,"elapsed":671,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"b9d63334-3226-4005-ec3e-0039dfd1c73d"},"source":["selected_dataset.train[DATA_COLUMN]"],"execution_count":21,"outputs":[{"output_type":"execute_result","data":{"text/plain":["0       الحمدلله يارب فوز مهم يا زمالك كل الدعم ليكم ي...\n","1                 فدوه يا بخت فدوه يا زمن واحد منكم يجيبه\n","2       يا رب يا واحد يا احد بحق يوم الاحد ان تهلك بني...\n","3       هوا الحريه يا وجع قلبي عليكي يا امي الله لا يح...\n","4         يا بكون بحياتك الاهم يا اما ما بدي اكون [EMOJI]\n","                              ...                        \n","6995    يا حمار يا جاهل نسبه الباطل ما بتتحسبش و عاملي...\n","6996    كل زق يا طاقيه يا واطي يا حقير يا تافه يا سافل...\n","6997    يا كبير يا ممتع يا نجم لابد ان تعي جيدا اننا م...\n","6998    يا رب الاتحاد يفوز يا رب [EMOJI][EMOJI] الاتحا...\n","6999    يعز عليا ادخل الشارع وملاقيكش واقف مستنيني في ...\n","Name: tweets, Length: 6984, dtype: object"]},"metadata":{"tags":[]},"execution_count":21}]},{"cell_type":"code","metadata":{"id":"4YS7XI2bZTyz","executionInfo":{"status":"ok","timestamp":1620335195931,"user_tz":-180,"elapsed":854,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}}},"source":["class BERTDataset(Dataset):\n","    def __init__(self, text, target, model_name, max_len, label_map):\n","      super(BERTDataset).__init__()\n","      self.text = text\n","      self.target = target\n","      self.tokenizer_name = model_name\n","      self.tokenizer = AutoTokenizer.from_pretrained(model_name)\n","      self.max_len = max_len\n","      self.label_map = label_map\n","      \n","\n","    def __len__(self):\n","      return len(self.text)\n","\n","    def __getitem__(self,item):\n","      text = str(self.text[item])\n","      text = \" \".join(text.split())\n","\n","\n","        \n","      input_ids = self.tokenizer.encode(\n","          text,\n","          add_special_tokens=True,\n","          max_length=self.max_len,\n","          truncation='longest_first'\n","      )     \n","    \n","      attention_mask = [1] * len(input_ids)\n","\n","      # Zero-pad up to the sequence length.\n","      padding_length = self.max_len - len(input_ids)\n","      input_ids = input_ids + ([self.tokenizer.pad_token_id] * padding_length)\n","      attention_mask = attention_mask + ([0] * padding_length)    \n","      \n","      return InputFeatures(input_ids=input_ids, attention_mask=attention_mask, label=self.label_map[self.target[item]])"],"execution_count":22,"outputs":[]},{"cell_type":"code","metadata":{"id":"mciZOFz-amkV","colab":{"base_uri":"https://localhost:8080/","height":132,"referenced_widgets":["e0d38a860e954197ad097cbdd8f0ff01","8b618bd08d704f97a46424e190988945","c5b3ef3845594ddfbf52cfd08df56738","df1f3d98a022447c8ddf9cf95c73be5c","8668c2146ae2406fa9b65f5ad59fe246","97130214138141aa8dd7bc674316ea89","12385897f2464530a286f49a0f9e425f","852df5dfba054fc1912afbe0dfddc97a","626c6d6d2abd4ebfa69b161a597019f2","d7d4909f4e394f318716d9892ba5ea0a","3ed4633c63054627b828c4018a52d9a7","962a28c003a443d89d98840d657e7463","ab32b2b3d85f47258d4aa8cbcd56da84","f303fc1d6d3e46f9ac6d63fcce44d178","4f2e29f519e54766af89008c5ec63181","6f384d0b58534dc6bd6975493c25254a"]},"executionInfo":{"status":"ok","timestamp":1620335213879,"user_tz":-180,"elapsed":5910,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"8b5470ee-b08c-450d-ab9a-66d6abcc76f8"},"source":["label_map = { v:index for index, v in enumerate(selected_dataset.label_list) }\n","print(label_map)\n","# label_map_test = { v:index for index, v in enumerate(df_test_labels.HS_Labels) }\n","# print(label_map_test)\n","# label_map_valid = { v:index for index, v in enumerate(df_valid.HS_Labels) }\n","# print(label_map_valid)\n","# train_dataset = BERTDataset(selected_dataset.train[DATA_COLUMN].to_list(),selected_dataset.train[LABEL_COLUMN].to_list(),model_name,max_len,label_map)\n","# test_dataset = BERTDataset(selected_dataset.test[DATA_COLUMN].to_list(),selected_dataset.test[LABEL_COLUMN].to_list(),model_name,max_len,label_map)\n","\n","train_dataset = BERTDataset(selected_dataset.train[DATA_COLUMN].to_list(),selected_dataset.train[LABEL_COLUMN].to_list(),model_name,max_len,label_map)\n","valid_dataset = BERTDataset(selected_dataset.valid[DATA_COLUMN].to_list(),selected_dataset.valid[LABEL_COLUMN].to_list(),model_name,max_len,label_map)\n","test_dataset = BERTDataset(selected_dataset.test[DATA_COLUMN].to_list(),selected_dataset.test[LABEL_COLUMN].to_list(),model_name,max_len,label_map)"],"execution_count":23,"outputs":[{"output_type":"stream","text":["{'OFF': 0, 'NOT_OFF': 1}\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"e0d38a860e954197ad097cbdd8f0ff01","version_minor":0,"version_major":2},"text/plain":["HBox(children=(FloatProgress(value=0.0, description='Downloading', max=576.0, style=ProgressStyle(description_…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"626c6d6d2abd4ebfa69b161a597019f2","version_minor":0,"version_major":2},"text/plain":["HBox(children=(FloatProgress(value=0.0, description='Downloading', max=717711.0, style=ProgressStyle(descripti…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"lt7l0IxjbmNu","executionInfo":{"status":"ok","timestamp":1620335216051,"user_tz":-180,"elapsed":630,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}}},"source":["def model_init():\n","    return AutoModelForSequenceClassification.from_pretrained(model_name, return_dict=True, num_labels=len(label_map))"],"execution_count":24,"outputs":[]},{"cell_type":"code","metadata":{"id":"UYU6G4vWc5nz","executionInfo":{"status":"ok","timestamp":1620335219380,"user_tz":-180,"elapsed":668,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}}},"source":["def compute_metrics(p): #p should be of type EvalPrediction\n","  preds = np.argmax(p.predictions, axis=1)\n","  assert len(preds) == len(p.label_ids)\n","  print(classification_report(p.label_ids,preds))\n","  print(confusion_matrix(p.label_ids,preds))\n","\n","  macro_f1_pos_neg = f1_score(p.label_ids,preds,average='macro',labels=[0,1])\n","  macro_f1 = f1_score(p.label_ids,preds,average='macro')\n","  macro_precision = precision_score(p.label_ids,preds,average='macro')\n","  macro_recall = recall_score(p.label_ids,preds,average='macro')\n","  acc = accuracy_score(p.label_ids,preds)\n","  return {\n","      'macro_f1' : macro_f1,\n","      'macro_f1_pos_neg' : macro_f1_pos_neg,  \n","      'macro_precision': macro_precision,\n","      'macro_recall': macro_recall,\n","      'accuracy': acc\n","  }"],"execution_count":25,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"GnqiZOT37ByE"},"source":["# HyperParameter Search"]},{"cell_type":"markdown","metadata":{"id":"bJif-78C6Kmn"},"source":["you can change the batch size and gradient accumulation from here\n","\n"]},{"cell_type":"code","metadata":{"id":"L3Z_kPB-dE_w","executionInfo":{"status":"ok","timestamp":1620335224363,"user_tz":-180,"elapsed":785,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}}},"source":["training_args = TrainingArguments(\"./train\")\n","training_args.evaluate_during_training = True\n","training_args.adam_epsilon = 1e-8\n","training_args.lr_scheduler_type = 'cosine'\n","training_args.fp16 = True\n","training_args.per_device_train_batch_size = 16\n","training_args.per_device_eval_batch_size = 16\n","training_args.gradient_accumulation_steps = 2\n","training_args.num_train_epochs= 8\n","training_args.evaluation_strategy = EvaluationStrategy.EPOCH\n","# training_args.logging_steps = 200\n","training_args.save_steps = 100000\n","# training_args.save_steps = \n","#training_args.eval_steps = \n","training_args.disable_tqdm = True\n","# print(\"Logging Step:\", training_args.logging_steps)\n","# print(\"Eval Step:\",training_args.eval_steps)"],"execution_count":26,"outputs":[]},{"cell_type":"code","metadata":{"id":"KeqRACPYheeb","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1620335226711,"user_tz":-180,"elapsed":783,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"88357e70-a8c9-4868-ee95-7518d1105d22"},"source":["steps_per_epoch = (len(selected_dataset.train)// (training_args.per_device_train_batch_size * training_args.gradient_accumulation_steps))\n","total_steps = steps_per_epoch * training_args.num_train_epochs\n","print(steps_per_epoch)\n","print(total_steps)"],"execution_count":27,"outputs":[{"output_type":"stream","text":["218\n","1744\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"o8HOnY6odcwG","colab":{"base_uri":"https://localhost:8080/","height":171,"referenced_widgets":["a5250298358146298124eab824f7f099","e721de6a21fc46ffaf068611c90af8cc","6d9dd5acc12d4ceabebb05e5b4311f62","eb683c64958b4be28e4e350072d1f38f","5bdb921bb7024c3ca7b227d75da9493c","7a288c5a7c0c45f28209e3cd99c18c9d","61836f8c343a4e349f5e8c8447925a05","74024e2426c64c4fa75f33a9129215e4"]},"executionInfo":{"status":"ok","timestamp":1620335255744,"user_tz":-180,"elapsed":28082,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"4e1abcc1-0c03-41d7-da9a-1aaff0632665"},"source":["trainer = Trainer(\n","    args=training_args,\n","    train_dataset=train_dataset, \n","    eval_dataset=valid_dataset, \n","    model_init=model_init,\n","    compute_metrics=compute_metrics,\n",")"],"execution_count":28,"outputs":[{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"a5250298358146298124eab824f7f099","version_minor":0,"version_major":2},"text/plain":["HBox(children=(FloatProgress(value=0.0, description='Downloading', max=543452854.0, style=ProgressStyle(descri…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"},{"output_type":"stream","text":["Some weights of the model checkpoint at qarib/bert-base-qarib were not used when initializing BertForSequenceClassification: ['cls.predictions.bias', 'cls.predictions.transform.dense.weight', 'cls.predictions.transform.dense.bias', 'cls.predictions.transform.LayerNorm.weight', 'cls.predictions.transform.LayerNorm.bias', 'cls.predictions.decoder.weight', 'cls.predictions.decoder.bias', 'cls.seq_relationship.weight', 'cls.seq_relationship.bias']\n","- This IS expected if you are initializing BertForSequenceClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).\n","- This IS NOT expected if you are initializing BertForSequenceClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).\n","Some weights of BertForSequenceClassification were not initialized from the model checkpoint at qarib/bert-base-qarib and are newly initialized: ['classifier.weight', 'classifier.bias']\n","You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.\n"],"name":"stderr"}]},{"cell_type":"code","metadata":{"id":"AFZ94M7Rzkhh","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1620335255747,"user_tz":-180,"elapsed":25121,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"5e3f6d0c-d782-4411-d5c0-a48e761b1dda"},"source":["def my_hp_space(trial):\n","    return {\n","        \"learning_rate\": trial.suggest_float(\"learning_rate\", 2e-5, 7e-5, step=1e-5),\n","        \"seed\": trial.suggest_categorical(\"seed\", [0, 1, 42, 666, 123, 12345]),\n","        \"warmup_steps\": trial.suggest_int(\"warmup_steps\",0,total_steps*0.1,step=total_steps*0.1*0.5)\n","    }\n","\n","search_space = {\n","    \"learning_rate\":  list(np.arange(2e-5, 7e-5, 1e-5)),\n","    \"seed\":  [0, 1, 42, 666, 123, 12345],\n","    \"warmup_steps\": list(range(0, int((total_steps)*0.1)+1, int(total_steps*0.1*0.5)))\n","}\n","search_space"],"execution_count":29,"outputs":[{"output_type":"execute_result","data":{"text/plain":["{'learning_rate': [2e-05,\n","  3.0000000000000004e-05,\n","  4.000000000000001e-05,\n","  5.000000000000001e-05,\n","  6.000000000000001e-05],\n"," 'seed': [0, 1, 42, 666, 123, 12345],\n"," 'warmup_steps': [0, 87, 174]}"]},"metadata":{"tags":[]},"execution_count":29}]},{"cell_type":"code","metadata":{"id":"PgfU2UVzfS_A","executionInfo":{"status":"ok","timestamp":1620335255748,"user_tz":-180,"elapsed":22856,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}}},"source":["def my_objective(metrics):\n","    return metrics['eval_macro_f1']"],"execution_count":30,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"nc4gOvtE66Mj"},"source":["choose a study name to save it on disk"]},{"cell_type":"code","metadata":{"id":"NSGLnBKv64sZ"},"source":["# name = \"qarib-semeval\""],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"7l821sW7fdaY"},"source":["# best_run = trainer.hyperparameter_search(direction=\"maximize\",\n","#                                          hp_space=my_hp_space,\n","#                                          compute_objective=my_objective,\n","#                                          n_trials=None,\n","#                                          pruner=optuna.pruners.NopPruner(),\n","#                                          sampler=optuna.samplers.GridSampler(search_space),\n","#                                          study_name=name,\n","#                                          storage=\"sqlite:////content/drive/MyDrive/{}.db\".format(name),\n","#                                          load_if_exists=False # you can change this to true, for continuing the search\n","#                                          )"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"OVwfM9ZJf12t"},"source":["# best_run"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"vTmvFEs41WkV"},"source":["#Regular Training"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"kTLYpWADhZPq","executionInfo":{"status":"ok","timestamp":1620335255748,"user_tz":-180,"elapsed":16002,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"614dd617-4fa6-4535-cc10-50d4afcda821"},"source":["training_args = TrainingArguments(\"./train\")\n","training_args.evaluate_during_training = True\n","training_args.adam_epsilon = 1e-8\n","training_args.learning_rate = 5e-5\n","training_args.fp16 = True\n","training_args.per_device_train_batch_size = 16\n","training_args.per_device_eval_batch_size = 16\n","training_args.gradient_accumulation_steps = 2\n","training_args.num_train_epochs= 8\n","\n","\n","steps_per_epoch = (len(selected_dataset.train)// (training_args.per_device_train_batch_size * training_args.gradient_accumulation_steps))\n","total_steps = steps_per_epoch * training_args.num_train_epochs\n","print(steps_per_epoch)\n","print(total_steps)\n","#Warmup_ratio\n","warmup_ratio = 0.1\n","training_args.warmup_steps = total_steps*warmup_ratio # or you can set the warmup steps directly \n","\n","training_args.evaluation_strategy = EvaluationStrategy.EPOCH\n","# training_args.logging_steps = 200\n","training_args.save_steps = 100000 #don't want to save any model, there is probably a better way to do this :)\n","training_args.seed = 42\n","training_args.disable_tqdm = False\n","training_args.lr_scheduler_type = 'cosine'"],"execution_count":31,"outputs":[{"output_type":"stream","text":["218\n","1744\n"],"name":"stdout"}]},{"cell_type":"markdown","metadata":{"id":"V_oGjIC-7Vow"},"source":["This paert allows you to do a regular training with no hyper parameter optimization"]},{"cell_type":"code","metadata":{"id":"Ro5BW5ak4uc1","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1620335260914,"user_tz":-180,"elapsed":18503,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"593396ff-92b9-46d1-fc66-266c4c433405"},"source":["trainer = Trainer(\n","    model = model_init(),\n","    args = training_args,\n","    train_dataset = train_dataset,\n","    eval_dataset=valid_dataset,\n","    compute_metrics=compute_metrics,\n",")"],"execution_count":32,"outputs":[{"output_type":"stream","text":["Some weights of the model checkpoint at qarib/bert-base-qarib were not used when initializing BertForSequenceClassification: ['cls.predictions.bias', 'cls.predictions.transform.dense.weight', 'cls.predictions.transform.dense.bias', 'cls.predictions.transform.LayerNorm.weight', 'cls.predictions.transform.LayerNorm.bias', 'cls.predictions.decoder.weight', 'cls.predictions.decoder.bias', 'cls.seq_relationship.weight', 'cls.seq_relationship.bias']\n","- This IS expected if you are initializing BertForSequenceClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).\n","- This IS NOT expected if you are initializing BertForSequenceClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).\n","Some weights of BertForSequenceClassification were not initialized from the model checkpoint at qarib/bert-base-qarib and are newly initialized: ['classifier.weight', 'classifier.bias']\n","You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.\n"],"name":"stderr"}]},{"cell_type":"code","metadata":{"id":"yx336O3J2SdQ","colab":{"base_uri":"https://localhost:8080/","height":1000},"executionInfo":{"status":"ok","timestamp":1620336296257,"user_tz":-180,"elapsed":1049017,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"0dad50bd-8ab5-4d2f-9aee-149312120a87"},"source":["trainer.train()"],"execution_count":33,"outputs":[{"output_type":"display_data","data":{"text/html":["\n","    <div>\n","        <style>\n","            /* Turns off some styling */\n","            progress {\n","                /* gets rid of default border in Firefox and Opera. */\n","                border: none;\n","                /* Needs to be in here for Safari polyfill so background images work as expected. */\n","                background-size: auto;\n","            }\n","        </style>\n","      \n","      <progress value='1744' max='1744' style='width:300px; height:20px; vertical-align: middle;'></progress>\n","      [1744/1744 17:14, Epoch 7/8]\n","    </div>\n","    <table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: left;\">\n","      <th>Epoch</th>\n","      <th>Training Loss</th>\n","      <th>Validation Loss</th>\n","      <th>Macro F1</th>\n","      <th>Macro F1 Pos Neg</th>\n","      <th>Macro Precision</th>\n","      <th>Macro Recall</th>\n","      <th>Accuracy</th>\n","      <th>Runtime</th>\n","      <th>Samples Per Second</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <td>0</td>\n","      <td>No log</td>\n","      <td>0.146912</td>\n","      <td>0.909272</td>\n","      <td>0.909272</td>\n","      <td>0.940608</td>\n","      <td>0.884362</td>\n","      <td>0.950000</td>\n","      <td>6.656100</td>\n","      <td>150.239000</td>\n","    </tr>\n","    <tr>\n","      <td>1</td>\n","      <td>No log</td>\n","      <td>0.202857</td>\n","      <td>0.890213</td>\n","      <td>0.890213</td>\n","      <td>0.864826</td>\n","      <td>0.924605</td>\n","      <td>0.930000</td>\n","      <td>6.351700</td>\n","      <td>157.439000</td>\n","    </tr>\n","    <tr>\n","      <td>2</td>\n","      <td>0.181800</td>\n","      <td>0.284202</td>\n","      <td>0.909641</td>\n","      <td>0.909641</td>\n","      <td>0.910543</td>\n","      <td>0.908747</td>\n","      <td>0.947000</td>\n","      <td>6.398300</td>\n","      <td>156.292000</td>\n","    </tr>\n","    <tr>\n","      <td>3</td>\n","      <td>0.181800</td>\n","      <td>0.307135</td>\n","      <td>0.916461</td>\n","      <td>0.916461</td>\n","      <td>0.917377</td>\n","      <td>0.915551</td>\n","      <td>0.951000</td>\n","      <td>6.446500</td>\n","      <td>155.123000</td>\n","    </tr>\n","    <tr>\n","      <td>4</td>\n","      <td>0.020700</td>\n","      <td>0.359005</td>\n","      <td>0.914942</td>\n","      <td>0.914942</td>\n","      <td>0.914942</td>\n","      <td>0.914942</td>\n","      <td>0.950000</td>\n","      <td>6.427700</td>\n","      <td>155.576000</td>\n","    </tr>\n","    <tr>\n","      <td>5</td>\n","      <td>0.020700</td>\n","      <td>0.382338</td>\n","      <td>0.913430</td>\n","      <td>0.913430</td>\n","      <td>0.912534</td>\n","      <td>0.914333</td>\n","      <td>0.949000</td>\n","      <td>6.404400</td>\n","      <td>156.143000</td>\n","    </tr>\n","    <tr>\n","      <td>6</td>\n","      <td>0.000900</td>\n","      <td>0.379202</td>\n","      <td>0.917623</td>\n","      <td>0.917623</td>\n","      <td>0.921385</td>\n","      <td>0.913976</td>\n","      <td>0.952000</td>\n","      <td>6.413100</td>\n","      <td>155.932000</td>\n","    </tr>\n","    <tr>\n","      <td>7</td>\n","      <td>0.000900</td>\n","      <td>0.381961</td>\n","      <td>0.917986</td>\n","      <td>0.917986</td>\n","      <td>0.919840</td>\n","      <td>0.916160</td>\n","      <td>0.952000</td>\n","      <td>6.411700</td>\n","      <td>155.964000</td>\n","    </tr>\n","  </tbody>\n","</table><p>"],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["              precision    recall  f1-score   support\n","\n","           0       0.93      0.78      0.85       179\n","           1       0.95      0.99      0.97       821\n","\n","    accuracy                           0.95      1000\n","   macro avg       0.94      0.88      0.91      1000\n","weighted avg       0.95      0.95      0.95      1000\n","\n","[[140  39]\n"," [ 11 810]]\n","              precision    recall  f1-score   support\n","\n","           0       0.75      0.92      0.82       179\n","           1       0.98      0.93      0.96       821\n","\n","    accuracy                           0.93      1000\n","   macro avg       0.86      0.92      0.89      1000\n","weighted avg       0.94      0.93      0.93      1000\n","\n","[[164  15]\n"," [ 55 766]]\n","              precision    recall  f1-score   support\n","\n","           0       0.85      0.85      0.85       179\n","           1       0.97      0.97      0.97       821\n","\n","    accuracy                           0.95      1000\n","   macro avg       0.91      0.91      0.91      1000\n","weighted avg       0.95      0.95      0.95      1000\n","\n","[[152  27]\n"," [ 26 795]]\n","              precision    recall  f1-score   support\n","\n","           0       0.87      0.86      0.86       179\n","           1       0.97      0.97      0.97       821\n","\n","    accuracy                           0.95      1000\n","   macro avg       0.92      0.92      0.92      1000\n","weighted avg       0.95      0.95      0.95      1000\n","\n","[[154  25]\n"," [ 24 797]]\n","              precision    recall  f1-score   support\n","\n","           0       0.86      0.86      0.86       179\n","           1       0.97      0.97      0.97       821\n","\n","    accuracy                           0.95      1000\n","   macro avg       0.91      0.91      0.91      1000\n","weighted avg       0.95      0.95      0.95      1000\n","\n","[[154  25]\n"," [ 25 796]]\n","              precision    recall  f1-score   support\n","\n","           0       0.86      0.86      0.86       179\n","           1       0.97      0.97      0.97       821\n","\n","    accuracy                           0.95      1000\n","   macro avg       0.91      0.91      0.91      1000\n","weighted avg       0.95      0.95      0.95      1000\n","\n","[[154  25]\n"," [ 26 795]]\n","              precision    recall  f1-score   support\n","\n","           0       0.87      0.85      0.86       179\n","           1       0.97      0.97      0.97       821\n","\n","    accuracy                           0.95      1000\n","   macro avg       0.92      0.91      0.92      1000\n","weighted avg       0.95      0.95      0.95      1000\n","\n","[[153  26]\n"," [ 22 799]]\n","              precision    recall  f1-score   support\n","\n","           0       0.87      0.86      0.87       179\n","           1       0.97      0.97      0.97       821\n","\n","    accuracy                           0.95      1000\n","   macro avg       0.92      0.92      0.92      1000\n","weighted avg       0.95      0.95      0.95      1000\n","\n","[[154  25]\n"," [ 23 798]]\n"],"name":"stdout"},{"output_type":"execute_result","data":{"text/plain":["TrainOutput(global_step=1744, training_loss=0.058385381898031045, metrics={'train_runtime': 1035.316, 'train_samples_per_second': 1.685, 'total_flos': 11600681300041728, 'epoch': 8.0})"]},"metadata":{"tags":[]},"execution_count":33}]},{"cell_type":"code","metadata":{"id":"agqaiJStrc_w","colab":{"base_uri":"https://localhost:8080/","height":377},"executionInfo":{"status":"ok","timestamp":1620336308832,"user_tz":-180,"elapsed":1058205,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}},"outputId":"8d636279-3be6-4c99-df89-1791797b9b80"},"source":["trainer.evaluate(test_dataset)"],"execution_count":34,"outputs":[{"output_type":"display_data","data":{"text/html":["\n","    <div>\n","        <style>\n","            /* Turns off some styling */\n","            progress {\n","                /* gets rid of default border in Firefox and Opera. */\n","                border: none;\n","                /* Needs to be in here for Safari polyfill so background images work as expected. */\n","                background-size: auto;\n","            }\n","        </style>\n","      \n","      <progress value='125' max='125' style='width:300px; height:20px; vertical-align: middle;'></progress>\n","      [125/125 00:12]\n","    </div>\n","    "],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["              precision    recall  f1-score   support\n","\n","           0       0.88      0.84      0.86       402\n","           1       0.96      0.97      0.97      1598\n","\n","    accuracy                           0.94      2000\n","   macro avg       0.92      0.90      0.91      2000\n","weighted avg       0.94      0.94      0.94      2000\n","\n","[[ 336   66]\n"," [  44 1554]]\n"],"name":"stdout"},{"output_type":"execute_result","data":{"text/plain":["{'epoch': 8.0,\n"," 'eval_accuracy': 0.945,\n"," 'eval_loss': 0.39010173082351685,\n"," 'eval_macro_f1': 0.9125761580877386,\n"," 'eval_macro_f1_pos_neg': 0.9125761580877386,\n"," 'eval_macro_precision': 0.9217348927875244,\n"," 'eval_macro_recall': 0.90414323874993,\n"," 'eval_runtime': 12.7766,\n"," 'eval_samples_per_second': 156.536}"]},"metadata":{"tags":[]},"execution_count":34}]},{"cell_type":"code","metadata":{"id":"RrmCpsROvS-z","executionInfo":{"status":"ok","timestamp":1620336308833,"user_tz":-180,"elapsed":1049481,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}}},"source":["# df_test_labels.columns = [LABEL_COLUMN]\n","# test_dataset = BERTDataset(selected_dataset.test[DATA_COLUMN].to_list(),selected_dataset.df_test_labels[LABEL_COLUMN].to_list(),model_name,max_len,label_map)"],"execution_count":35,"outputs":[]},{"cell_type":"code","metadata":{"id":"Seyz8Yaj2ZCK","executionInfo":{"status":"ok","timestamp":1620336310636,"user_tz":-180,"elapsed":1050849,"user":{"displayName":"Do salam","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GgP0GyFxHH-3NAPSZ_ethp4uMqaN8pUWhOxcO0NDw=s64","userId":"03587359084159229589"}}},"source":["trainer.save_model(\"QARIB MODEL\")"],"execution_count":36,"outputs":[]},{"cell_type":"code","metadata":{"id":"xd1iuK-UFjEV"},"source":[""],"execution_count":null,"outputs":[]}]}